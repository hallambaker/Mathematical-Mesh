<?xml version='1.0' encoding='utf-8'?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" category="info" docName="draft-hallambaker-mesh-presentation-00" indexInclude="false" ipr="trust200902" prepTime="2021-04-13T11:45:33Z" scripts="Common,Latin" sortRefs="true" submissionType="independent" symRefs="true" tocDepth="3" tocInclude="true" version="3" xml:lang="en"><front>
<title abbrev="Reliable Datagram Protocol">Mathematical Mesh 3.0 Part VI: Reliable Datagram Protocol</title>
<seriesInfo name="Internet-Draft" value="draft-hallambaker-mesh-presentation" stream="independent"/>
<author fullname="Phillip Hallam-Baker" initials="P. M." surname="Hallam-Baker"><organization>ThresholdSecrets.com</organization>
<address>
<email>phill@hallambaker.com</email>
</address>
</author>
<date day="13" month="April" year="2021"/>
<area/>
<workgroup/>
<keyword>Threshold Cryptography</keyword>
<keyword>Elliptic Curve</keyword>
<keyword>Threshold Encryption</keyword>
<keyword>Threshold Key Generation</keyword>
<keyword>Ceremony</keyword>
<abstract>
<t>A presentation layer suitable for use in conjunction with HTTP and UDP transports is described.</t>
<t><eref target="http://whatever">https://mailarchive.ietf.org/arch/browse/mathmesh/</eref>Discussion of this draft should take place on the MathMesh mailing list (mathmesh@ietf.org), which is archived at .</t>
</abstract>
</front>
<middle>
<section title="Introduction" anchor="n-introduction"><t>The Reliable Datagram Protocol (RDP) is a lightweight key exchange, authentication and encryption protocol that provides a transactional presentation when layered over a HTTP transport and transactional and streaming presentations when layered over a UDP transport.</t>
<t>The UDP binding of RDP provides much of the functionality normally provided through use of TCP, TLS, HTTP and Web Sockets with considerably less complexity. RDP does not attempt to reproduce all the functionality of these protocols, only the functionality required by Web Services and streaming applications is provided.</t>
<figure>
<name>
Mesh Presentation Layer provides a combination of necessary functionality from TCP, TLS, HTTP and Web Sockets.</name>
<!-- Include SVG File ../Images/PresentationTcpTlsHttp2RDP.svg --><artwork type="svg">
<svg width="464" height="249" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 160,0" fill="none" stroke="black" />
  <path d="M 288,0 L 448,0" fill="none" stroke="black" />
  <path d="M 160,16 L 280,16" fill="none" stroke="black" />
  <path d="M 0,32 L 160,32" fill="none" stroke="black" />
  <path d="M 0,64 L 160,64" fill="none" stroke="black" />
  <path d="M 160,80 L 280,80" fill="none" stroke="black" />
  <path d="M 0,96 L 160,96" fill="none" stroke="black" />
  <path d="M 0,128 L 160,128" fill="none" stroke="black" />
  <path d="M 160,144 L 280,144" fill="none" stroke="black" />
  <path d="M 0,160 L 160,160" fill="none" stroke="black" />
  <path d="M 0,192 L 160,192" fill="none" stroke="black" />
  <path d="M 160,208 L 280,208" fill="none" stroke="black" />
  <path d="M 0,224 L 160,224" fill="none" stroke="black" />
  <path d="M 288,224 L 448,224" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 0,64 L 0,96" fill="none" stroke="black" />
  <path d="M 0,128 L 0,160" fill="none" stroke="black" />
  <path d="M 0,192 L 0,224" fill="none" stroke="black" />
  <path d="M 160,0 L 160,16" fill="none" stroke="black" />
  <path d="M 160,16 L 160,32" fill="none" stroke="black" />
  <path d="M 160,64 L 160,80" fill="none" stroke="black" />
  <path d="M 160,80 L 160,96" fill="none" stroke="black" />
  <path d="M 160,128 L 160,144" fill="none" stroke="black" />
  <path d="M 160,144 L 160,160" fill="none" stroke="black" />
  <path d="M 160,192 L 160,208" fill="none" stroke="black" />
  <path d="M 160,208 L 160,224" fill="none" stroke="black" />
  <path d="M 288,0 L 288,224" fill="none" stroke="black" />
  <path d="M 448,0 L 448,224" fill="none" stroke="black" />
  <polygon points="288.000000,16.000000 276.000000,10.400000 276.000000,21.600000" fill="black" transform="rotate(0.000000, 280.000000, 16.000000)" />
  <polygon points="288.000000,80.000000 276.000000,74.400002 276.000000,85.599998" fill="black" transform="rotate(0.000000, 280.000000, 80.000000)" />
  <polygon points="288.000000,144.000000 276.000000,138.399994 276.000000,149.600006" fill="black" transform="rotate(0.000000, 280.000000, 144.000000)" />
  <polygon points="288.000000,208.000000 276.000000,202.399994 276.000000,213.600006" fill="black" transform="rotate(0.000000, 280.000000, 208.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="80" y="84">L</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="84">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="116">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="116">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="212">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="212">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="84">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="116">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="116">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="212">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="212">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="148">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="212">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="212">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="116">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="116">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="132">L</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="132">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="148">H</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="212">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="100">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="116">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="148">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="148">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="212">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="100">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="116">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="212">W</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="100">M</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="116">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="132">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="212">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="116">P</text>
</g></svg>
</artwork>
</figure>
<t>As recognized in the design of QUIC, combining these protocols allows greater efficiency and security. But QUIC is the product of one set of design choices optimized to meet an important but specific set of needs. RDP makes a different set of choices to meet a different set of needs. A natural consequence of moving TCP functionality from a platform capability implemented in the OS kernel to an application level resource it that applications are now free to chose the transport and security capabilities that best fit their needs rather than being limited to a single size fits all.</t>
<t>The reduction in complexity afforded by combining four protocols into one allows entirely new communications patterns to be supported that are poorly supported by traditional approaches. HTTP is built on the Remote Procedure Call model of transactions that consist of a single request followed by a response. Using this communication pattern, a device attempting to synchronize a local store with a store at a remote service is required to periodically poll the service for updates:</t>
<figure>
<name>
Limiting communications to a request/response communication requires inefficient polling for updates.</name>
<!-- Include SVG File ../Images/PresentationHttpPolling.svg --><artwork type="svg">
<svg width="464" height="233" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,16 L 160,16" fill="none" stroke="black" />
  <path d="M 288,16 L 448,16" fill="none" stroke="black" />
  <path d="M 0,48 L 80,48" fill="none" stroke="black" />
  <path d="M 80,48 L 160,48" fill="none" stroke="black" />
  <path d="M 288,48 L 376,48" fill="none" stroke="black" />
  <path d="M 376,48 L 448,48" fill="none" stroke="black" />
  <path d="M 80,80 L 200,80" fill="none" stroke="black" />
  <path d="M 256,80 L 368,80" fill="none" stroke="black" />
  <path d="M 88,96 L 176,96" fill="none" stroke="black" />
  <path d="M 272,96 L 376,96" fill="none" stroke="black" />
  <path d="M 80,128 L 200,128" fill="none" stroke="black" />
  <path d="M 256,128 L 368,128" fill="none" stroke="black" />
  <path d="M 88,144 L 176,144" fill="none" stroke="black" />
  <path d="M 272,144 L 376,144" fill="none" stroke="black" />
  <path d="M 80,176 L 200,176" fill="none" stroke="black" />
  <path d="M 256,176 L 368,176" fill="none" stroke="black" />
  <path d="M 88,192 L 192,192" fill="none" stroke="black" />
  <path d="M 264,192 L 376,192" fill="none" stroke="black" />
  <path d="M 0,16 L 0,48" fill="none" stroke="black" />
  <path d="M 80,48 L 80,80" fill="none" stroke="black" />
  <path d="M 80,80 L 80,128" fill="none" stroke="black" />
  <path d="M 80,128 L 80,176" fill="none" stroke="black" />
  <path d="M 80,176 L 80,208" fill="none" stroke="black" />
  <path d="M 160,16 L 160,48" fill="none" stroke="black" />
  <path d="M 288,16 L 288,48" fill="none" stroke="black" />
  <path d="M 376,48 L 376,96" fill="none" stroke="black" />
  <path d="M 376,96 L 376,144" fill="none" stroke="black" />
  <path d="M 376,144 L 376,192" fill="none" stroke="black" />
  <path d="M 376,192 L 376,208" fill="none" stroke="black" />
  <path d="M 448,16 L 448,48" fill="none" stroke="black" />
  <polygon points="96.000000,96.000000 84.000000,90.400002 84.000000,101.599998" fill="black" transform="rotate(180.000000, 88.000000, 96.000000)" />
  <polygon points="96.000000,144.000000 84.000000,138.399994 84.000000,149.600006" fill="black" transform="rotate(180.000000, 88.000000, 144.000000)" />
  <polygon points="96.000000,192.000000 84.000000,186.399994 84.000000,197.600006" fill="black" transform="rotate(180.000000, 88.000000, 192.000000)" />
  <polygon points="376.000000,80.000000 364.000000,74.400002 364.000000,85.599998" fill="black" transform="rotate(0.000000, 368.000000, 80.000000)" />
  <polygon points="376.000000,128.000000 364.000000,122.400002 364.000000,133.600006" fill="black" transform="rotate(0.000000, 368.000000, 128.000000)" />
  <polygon points="376.000000,176.000000 364.000000,170.399994 364.000000,181.600006" fill="black" transform="rotate(0.000000, 368.000000, 176.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="256" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="132">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="148">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="84">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="84">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="100">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="180">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="100">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="148">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="148">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="148">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="100">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="180">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="196">U</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="180">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="196">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="36">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="100">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="132">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="196">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="84">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="100">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="148">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="148">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="180">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="36">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="36">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="100">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="100">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="196">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="196">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="196">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="148">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="148">e</text>
</g></svg>
</artwork>
</figure>
<t>RDP allows a client device with this particular requirement to subscribe to a continuous stream of updates. There is no need for the device to poll the remote store for updates as it will be notified every time an update occurs.</t>
<figure>
<name>
RDP supports asynchronous streaming of updates as they occur.</name>
<!-- Include SVG File ../Images/PresentationRDPSubscription.svg --><artwork type="svg">
<svg width="464" height="249" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 160,0" fill="none" stroke="black" />
  <path d="M 288,0 L 448,0" fill="none" stroke="black" />
  <path d="M 0,32 L 80,32" fill="none" stroke="black" />
  <path d="M 80,32 L 160,32" fill="none" stroke="black" />
  <path d="M 288,32 L 376,32" fill="none" stroke="black" />
  <path d="M 376,32 L 448,32" fill="none" stroke="black" />
  <path d="M 88,64 L 176,64" fill="none" stroke="black" />
  <path d="M 272,64 L 368,64" fill="none" stroke="black" />
  <path d="M 88,80 L 168,80" fill="none" stroke="black" />
  <path d="M 280,80 L 368,80" fill="none" stroke="black" />
  <path d="M 88,144 L 192,144" fill="none" stroke="black" />
  <path d="M 264,144 L 368,144" fill="none" stroke="black" />
  <path d="M 88,192 L 192,192" fill="none" stroke="black" />
  <path d="M 264,192 L 368,192" fill="none" stroke="black" />
  <path d="M 88,208 L 192,208" fill="none" stroke="black" />
  <path d="M 264,208 L 368,208" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 80,32 L 80,224" fill="none" stroke="black" />
  <path d="M 160,0 L 160,32" fill="none" stroke="black" />
  <path d="M 288,0 L 288,32" fill="none" stroke="black" />
  <path d="M 376,32 L 376,224" fill="none" stroke="black" />
  <path d="M 448,0 L 448,32" fill="none" stroke="black" />
  <polygon points="96.000000,80.000000 84.000000,74.400002 84.000000,85.599998" fill="black" transform="rotate(180.000000, 88.000000, 80.000000)" />
  <polygon points="96.000000,144.000000 84.000000,138.399994 84.000000,149.600006" fill="black" transform="rotate(180.000000, 88.000000, 144.000000)" />
  <polygon points="96.000000,192.000000 84.000000,186.399994 84.000000,197.600006" fill="black" transform="rotate(180.000000, 88.000000, 192.000000)" />
  <polygon points="96.000000,208.000000 84.000000,202.399994 84.000000,213.600006" fill="black" transform="rotate(180.000000, 88.000000, 208.000000)" />
  <polygon points="376.000000,64.000000 364.000000,58.400002 364.000000,69.599998" fill="black" transform="rotate(0.000000, 368.000000, 64.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="384" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="148">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="148">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="196">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="148">U</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="68">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="68">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="68">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="212">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="212">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="68">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="84">w</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="84">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="196">U</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="196">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="68">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="84">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="212">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="68">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="84">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="196">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="68">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="148">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="212">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="68">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="84">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="84">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="212">U</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="196">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="212">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="68">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="84">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="148">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="196">t</text>
</g></svg>
</artwork>
</figure>
<t>While it is possible to achieve the same functionality in TCP, this requires that the device and service maintain a TCP connection for the duration of the connection. This consumes communication resources and operating system resources.</t>
<t>As is shown in later sections, the 'blank slate' design approach of RDP allows completely new approaches to service discovery, network agility, presence, NAT tunneling and many other requirements that are critical in modern network use.</t>
<section title="Background" anchor="n-background"><t>Web Services have traditionally made use of HTTP bindings over TCP or TLS transports. While this approach is functional, it is less than satisfactory. The HTTP and TLS stacks are designed to meet the needs of Web browsing but fail to provide significant capabilities required by a service. Modern implementations of these stacks are large and cumbersome but little of that complexity addresses needs relevant to Web Services.</t>
<t>A basic requirement for a Web Service is the need to authenticate requests and the party making them. In particular, a Web Service requires the ability to authenticate the source of a request and verify that authentication of the request data is complete before acting on it. As its original name, 'Secure Socket Layer' implies, TLS is designed to present an abstract socket layer that hides this information from the application layer. In many large enterprise deployments, TLS processing and Web Service transactions are performed on separate machines and information from the TLS session is only visible to the transaction processor if special provision is made.</t>
<t>HTTP provides a wide range of protocol capabilities but almost none of this complexity is relevant to Web Services needs. </t>
<ul>
<li>Providing access to multiple Web Services through a single TCP/IP port.</li>
<li>Delineating the beginning and end of request and response data.</li>
</ul>
<t>Recognizing these needs, the DARE envelope format was originally conceived as a JSON equivalent of the XML Signature and Encryption protocols applied to provide message layer security in the WS-Security stack. Consideration of the resource requirements needed to verify each transaction request and sign each response led to the need for a key exchange mechanism and that this should be separate from the Mesh Service Protocol. This in turn led to the realization that in most circumstances, an AEAD scheme such as AES-GCM or AES-CFB would provide encryption with the same or less overhead than use of a MAC.</t>
<t>Having taken these considerations into account, a new lightweight envelope format was designed to allow authentication and encryption of Web Services messages as the payload of HTTP requests and responses. The success of this approach led to the realization that the same format could be modified to enable direct binding to UDP, allowing provision of HTTP support to be made optional.</t>
<section title="Protocol Elements" anchor="n-protocol-elements"><t>A TCP connection provides a single pair of bidirectional communication streams between two devices connected to the network. While the TCP connection is symmetric from the application layer point of view, the HTTP presentation layer is not. HTTP limits communications to a request/response communication pattern in which the initiator device makes all the requests and the responder device makes all the responses.</t>
<t>RDP affords greater communication flexibility requiring distinctions to be made between terms which may be used interchangeably in the HTTP over TCP/IP case.</t>
<dl>
<dt>Connection</dt>
<dd>
<t>An RDP connection is a bidirectional relationship between a pair of endpoints established through a cryptographic key exchange establishing a shared secret called the Connection Origin Key.</t>
</dd>
<dt>Stream</dt>
<dd>
<t>An RDP stream is an individual communication channel established within a connection. An RDP connection comprises one or more streams.</t>
</dd>
<dt>Port</dt>
<dd>
<t>An RDP port is a network interface through which data is exchanged. Currently only UDP and HTTP ports are supported. Each end of an RDP Connection accepts packets through one or more ports.</t>
</dd>
</dl>
<t>The distinction between connections and streams is analogous to that made between processes and threads. While any task that is performed by a separate thread may be performed by a separate process, use of threads consumes fewer platform resources and greater convenience to the programmer.</t>
<t>In the TCP/IP model, each stream is bound to a single pair of IP port. In the RDP model, any stream <bcp14>MAY</bcp14> make use of any available destination port to send traffic. This allows Alice to move from her home to her car to her office without dropping the connection to her conference call.</t>
<figure>
<name>
An RDP connection comprises one or more streams and one or more ports.</name>
<!-- Include SVG File ../Images/PresentationConnectionsStreamsPorts.svg --><artwork type="svg">
<svg width="528" height="217" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 512,0" fill="none" stroke="black" />
  <path d="M 24,48 L 144,48" fill="none" stroke="black" />
  <path d="M 168,48 L 288,48" fill="none" stroke="black" />
  <path d="M 368,48 L 488,48" fill="none" stroke="black" />
  <path d="M 304,80 L 312,80" fill="none" stroke="black" />
  <path d="M 320,80 L 328,80" fill="none" stroke="black" />
  <path d="M 336,80 L 344,80" fill="none" stroke="black" />
  <path d="M 352,80 L 360,80" fill="none" stroke="black" />
  <path d="M 24,112 L 144,112" fill="none" stroke="black" />
  <path d="M 168,112 L 288,112" fill="none" stroke="black" />
  <path d="M 368,112 L 488,112" fill="none" stroke="black" />
  <path d="M 0,128 L 128,128" fill="none" stroke="black" />
  <path d="M 128,128 L 256,128" fill="none" stroke="black" />
  <path d="M 256,128 L 384,128" fill="none" stroke="black" />
  <path d="M 384,128 L 512,128" fill="none" stroke="black" />
  <path d="M 0,192 L 128,192" fill="none" stroke="black" />
  <path d="M 128,192 L 256,192" fill="none" stroke="black" />
  <path d="M 256,192 L 384,192" fill="none" stroke="black" />
  <path d="M 384,192 L 512,192" fill="none" stroke="black" />
  <path d="M 0,0 L 0,128" fill="none" stroke="black" />
  <path d="M 0,128 L 0,192" fill="none" stroke="black" />
  <path d="M 24,48 L 24,112" fill="none" stroke="black" />
  <path d="M 128,128 L 128,192" fill="none" stroke="black" />
  <path d="M 144,48 L 144,112" fill="none" stroke="black" />
  <path d="M 168,48 L 168,112" fill="none" stroke="black" />
  <path d="M 256,128 L 256,192" fill="none" stroke="black" />
  <path d="M 288,48 L 288,112" fill="none" stroke="black" />
  <path d="M 368,48 L 368,112" fill="none" stroke="black" />
  <path d="M 384,128 L 384,192" fill="none" stroke="black" />
  <path d="M 488,48 L 488,112" fill="none" stroke="black" />
  <path d="M 512,0 L 512,128" fill="none" stroke="black" />
  <path d="M 512,128 L 512,192" fill="none" stroke="black" />
  <text text-anchor="middle" font-family="sans-serif" x="328" y="164">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="84">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="164">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="164">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="164">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="164">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="164">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="84">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="164">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="164">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="164">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="164">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="164">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="84">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="84">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="84">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="84">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="84">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="84">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="164">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="164">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="164">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="84">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="164">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="164">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="20">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="84">e</text>
</g></svg>
</artwork>
</figure>
<t>New streams may be created at any time by either party in a connection for many different reasons:</t>
<ul>
<li>To establish a client/service relationship to a different Web Service.</li>
<li>To establish a new asynchronous streaming relationship</li>
<li>To signal changes to the cryptographic context (e.g., forward secrecy rachet operation).</li>
<li>Exhaustion of the datagram counter identifier space.</li>
<li>To make use of traffic analysis avoidance techniques.</li>
<li>To enable datagrams to be sent at different priorities.</li>
</ul>
<t> A device connected to three separate Web Services provided by the same host establishes a separate stream for each service. This enables the device to present different application-level credentials top the different services. If permitted by the service, separate tasks on the same device <bcp14>MAY</bcp14> establish separate streams to the same service. This allows separate threads to wait on transactions taking a long time to complete without contention.</t>
<t>Each stream presents a sequence of datagrams spanning one or more packets according to a declared characteristic. The datagram represents the unit of payload data that is authenticated and thus the unit of payload data that is presented to the calling API.</t>
<figure>
<name>
An RDP stream presents a sequence of datagrams, each of which may span multiple packets.</name>
<!-- Include SVG File ../Images/PresentationStreamsDatagramsPackets.svg --><artwork type="svg">
<svg width="552" height="121" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 536,0" fill="none" stroke="black" />
  <path d="M 0,32 L 72,32" fill="none" stroke="black" />
  <path d="M 72,32 L 144,32" fill="none" stroke="black" />
  <path d="M 144,32 L 216,32" fill="none" stroke="black" />
  <path d="M 216,32 L 288,32" fill="none" stroke="black" />
  <path d="M 288,32 L 360,32" fill="none" stroke="black" />
  <path d="M 360,32 L 432,32" fill="none" stroke="black" />
  <path d="M 432,32 L 504,32" fill="none" stroke="black" />
  <path d="M 504,32 L 536,32" fill="none" stroke="black" />
  <path d="M 0,64 L 72,64" fill="none" stroke="black" />
  <path d="M 72,64 L 144,64" fill="none" stroke="black" />
  <path d="M 144,64 L 216,64" fill="none" stroke="black" />
  <path d="M 216,64 L 288,64" fill="none" stroke="black" />
  <path d="M 288,64 L 360,64" fill="none" stroke="black" />
  <path d="M 360,64 L 432,64" fill="none" stroke="black" />
  <path d="M 432,64 L 504,64" fill="none" stroke="black" />
  <path d="M 504,64 L 536,64" fill="none" stroke="black" />
  <path d="M 0,96 L 72,96" fill="none" stroke="black" />
  <path d="M 72,96 L 144,96" fill="none" stroke="black" />
  <path d="M 144,96 L 216,96" fill="none" stroke="black" />
  <path d="M 216,96 L 288,96" fill="none" stroke="black" />
  <path d="M 288,96 L 360,96" fill="none" stroke="black" />
  <path d="M 360,96 L 432,96" fill="none" stroke="black" />
  <path d="M 432,96 L 504,96" fill="none" stroke="black" />
  <path d="M 504,96 L 536,96" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 0,32 L 0,64" fill="none" stroke="black" />
  <path d="M 0,64 L 0,96" fill="none" stroke="black" />
  <path d="M 72,64 L 72,96" fill="none" stroke="black" />
  <path d="M 144,64 L 144,96" fill="none" stroke="black" />
  <path d="M 216,32 L 216,64" fill="none" stroke="black" />
  <path d="M 216,64 L 216,96" fill="none" stroke="black" />
  <path d="M 288,32 L 288,64" fill="none" stroke="black" />
  <path d="M 288,64 L 288,96" fill="none" stroke="black" />
  <path d="M 360,64 L 360,96" fill="none" stroke="black" />
  <path d="M 432,32 L 432,64" fill="none" stroke="black" />
  <path d="M 432,64 L 432,96" fill="none" stroke="black" />
  <path d="M 504,64 L 504,96" fill="none" stroke="black" />
  <polygon points="544.000000,0.000000 532.000000,-5.600000 532.000000,5.600000" fill="black" transform="rotate(0.000000, 536.000000, 0.000000)" />
  <polygon points="544.000000,32.000000 532.000000,26.400000 532.000000,37.599998" fill="black" transform="rotate(0.000000, 536.000000, 32.000000)" />
  <polygon points="544.000000,64.000000 532.000000,58.400002 532.000000,69.599998" fill="black" transform="rotate(0.000000, 536.000000, 64.000000)" />
  <polygon points="544.000000,96.000000 532.000000,90.400002 532.000000,101.599998" fill="black" transform="rotate(0.000000, 536.000000, 96.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="264" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="520" y="52">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="52">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="52">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="20">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="52">2</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="52">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="52">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="52">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="52">3</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="52">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="52">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="52">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="52">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="504" y="52">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="52">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="496" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="52">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="52">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="52">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="52">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="52">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="52">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="84">a</text>
</g></svg>
</artwork>
</figure>
<t>Two stream characteristics are currently defined, both of which are asymmetric.</t>
<dl>
<dt>Transactional Stream</dt>
<dd>
<t>Each request sent in the forward direction is followed by a response returned in the reverse direction.</t>
</dd>
<dt>Asynchronous Stream</dt>
<dd>
<t>A sequence of frames is received in the forward direction as directed by control messages sent in the reverse direction.</t>
</dd>
</dl>
<t>Thus, a bidirectional voice call between Alice and Bob requires a minimum of two Asynchronous Content streams, from Alice to Bob and from Bob to Alice.</t>
</section>
<section title="Application Interface" anchor="n-application-interface"><t>The traditional TCP/IP programming API exposes only an undifferentiated stream of bytes to the application program context. Information such as packet latency, packet loss rate, error rate, etc. are only available through proprietary platform specific APIs, if at all.</t>
<t>RDP is designed to provide application programs with relevant connection information including:</t>
<ul>
<li>Time since the most recent forward secrecy exchange</li>
<li>Average round trip latency (per port)</li>
<li>Packet loss (per port)</li>
</ul>
<t>Providing this information allows applications to adapt to changing network conditions.</t>
<ul>
<li>Forcing a forward secrecy exchange when a participant leaves a shared chat context</li>
<li>Making use of an outbound port with a different physical network connection.</li>
<li>Establishing communication to a different host.</li>
<li>Pre-empt (i.e. abandon) transfer of large datagrams in mid transfer.</li>
</ul>
<t>The API exposes the following object classes:</t>
<dl>
<dt>Connection</dt>
<dd>
<t>Reports the connection status, supports creation of new Streams.</t>
</dd>
<dt>Transactional Stream Initiator</dt>
<dd>
<t>Supports the Post method comprising sending a request to the service to which the stream is bound and waiting for a response.</t>
</dd>
<dt>Transactional Stream Responder</dt>
<dd>
<t>Is generated on receipt of a service request to which it is dispatched to obtain the service response.</t>
</dd>
<dt>Asynchronous Stream Sender</dt>
<dd>
<t>Allows transmission of a sequence of datagrams to a receiver. Reports stream properties set by the receiver.</t>
</dd>
<dt>Asynchronous Stream Receiver</dt>
<dd>
<t>Receives a continuous sequence of datagrams from the sender. Allows setting of stream properties.</t>
</dd>
<dt>Datagram</dt>
<dd>
<t>Exposes the packet data relevant transmission information.</t>
</dd>
<dt>Stream Creation Ticket</dt>
<dd>
<t>A stream creation ticket is a record created by an issuer device consisting of a stream identifier, a set of network endpoints, a shared secret and the issuer device's credential.</t>
</dd>
</dl>
<t>The details of the RDP API are out of scope for this specification.</t>
</section>
</section>
<section title="Use Cases" anchor="n-use-cases"><t>Despite representing a modest incremental advance on the complexity of TCP and a substantial reduction in complexity compared to TLS, RDP provides support for a wide range of use cases outside the scope of either.</t>
<section title="Network Agility" anchor="n-network-agility"><t>The separation of RDP streams from the network ports through which they are realized allows network agility to be supported without any additional complexity.</t>
<t>For example, Alice joins a conference call from her mobile phone in her home office. When she leaves for work in her car, the connection to her conference call is transferred seamlessly from hew home WiFi service to her mobile carrier.</t>
<figure>
<name>
Alice maintains connection to her conference call when moving from her home to her office.</name>
<!-- Include SVG File ../Images/PresentationNetworkAgility.svg --><artwork type="svg">
<svg width="512" height="345" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 160,0" fill="none" stroke="black" />
  <path d="M 336,0 L 496,0" fill="none" stroke="black" />
  <path d="M 32,48 L 128,48" fill="none" stroke="black" />
  <path d="M 368,48 L 464,48" fill="none" stroke="black" />
  <path d="M 216,64 L 280,64" fill="none" stroke="black" />
  <path d="M 32,80 L 128,80" fill="none" stroke="black" />
  <path d="M 368,80 L 464,80" fill="none" stroke="black" />
  <path d="M 32,112 L 80,112" fill="none" stroke="black" />
  <path d="M 80,112 L 128,112" fill="none" stroke="black" />
  <path d="M 368,112 L 416,112" fill="none" stroke="black" />
  <path d="M 416,112 L 464,112" fill="none" stroke="black" />
  <path d="M 0,128 L 80,128" fill="none" stroke="black" />
  <path d="M 80,128 L 160,128" fill="none" stroke="black" />
  <path d="M 336,128 L 416,128" fill="none" stroke="black" />
  <path d="M 416,128 L 496,128" fill="none" stroke="black" />
  <path d="M 80,160 L 224,160" fill="none" stroke="black" />
  <path d="M 280,160 L 416,160" fill="none" stroke="black" />
  <path d="M 168,192 L 224,192" fill="none" stroke="black" />
  <path d="M 224,192 L 280,192" fill="none" stroke="black" />
  <path d="M 280,192 L 328,192" fill="none" stroke="black" />
  <path d="M 200,208 L 224,208" fill="none" stroke="black" />
  <path d="M 224,208 L 280,208" fill="none" stroke="black" />
  <path d="M 280,208 L 296,208" fill="none" stroke="black" />
  <path d="M 200,240 L 296,240" fill="none" stroke="black" />
  <path d="M 200,272 L 248,272" fill="none" stroke="black" />
  <path d="M 248,272 L 296,272" fill="none" stroke="black" />
  <path d="M 168,320 L 328,320" fill="none" stroke="black" />
  <path d="M 0,0 L 0,128" fill="none" stroke="black" />
  <path d="M 32,48 L 32,80" fill="none" stroke="black" />
  <path d="M 32,80 L 32,112" fill="none" stroke="black" />
  <path d="M 80,112 L 80,128" fill="none" stroke="black" />
  <path d="M 80,128 L 80,160" fill="none" stroke="black" />
  <path d="M 128,48 L 128,80" fill="none" stroke="black" />
  <path d="M 128,80 L 128,112" fill="none" stroke="black" />
  <path d="M 160,0 L 160,128" fill="none" stroke="black" />
  <path d="M 168,192 L 168,320" fill="none" stroke="black" />
  <path d="M 200,208 L 200,240" fill="none" stroke="black" />
  <path d="M 200,240 L 200,272" fill="none" stroke="black" />
  <path d="M 224,160 L 224,192" fill="none" stroke="black" />
  <path d="M 224,192 L 224,208" fill="none" stroke="black" />
  <path d="M 280,160 L 280,192" fill="none" stroke="black" />
  <path d="M 280,192 L 280,208" fill="none" stroke="black" />
  <path d="M 296,208 L 296,240" fill="none" stroke="black" />
  <path d="M 296,240 L 296,272" fill="none" stroke="black" />
  <path d="M 328,192 L 328,320" fill="none" stroke="black" />
  <path d="M 336,0 L 336,128" fill="none" stroke="black" />
  <path d="M 368,48 L 368,80" fill="none" stroke="black" />
  <path d="M 368,80 L 368,112" fill="none" stroke="black" />
  <path d="M 416,112 L 416,128" fill="none" stroke="black" />
  <path d="M 416,128 L 416,160" fill="none" stroke="black" />
  <path d="M 464,48 L 464,80" fill="none" stroke="black" />
  <path d="M 464,80 L 464,112" fill="none" stroke="black" />
  <path d="M 496,0 L 496,128" fill="none" stroke="black" />
  <polygon points="288.000000,64.000000 276.000000,58.400002 276.000000,69.599998" fill="black" transform="rotate(0.000000, 280.000000, 64.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="432" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="36">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="36">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="52">L</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="100">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="228">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="260">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="100">G</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="228">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="260">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="52">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="68">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="100">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="36">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="68">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="68">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="100">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="228">L</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="308">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="36">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="36">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="52">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="68">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="100">W</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="260">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="36">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="68">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="100">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="260">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="260">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="52">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="68">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="68">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="68">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="100">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="260">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="68">3</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="100">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="228">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="52">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="68">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="100">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="228">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="68">3</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="100">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="100">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="308">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="36">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="36">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="260">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="36">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="52">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="100">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="100">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="228">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="68">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="68">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="68">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="100">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="228">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="308">b</text>
</g></svg>
</artwork>
</figure>
<t>The same approach <bcp14>MAY</bcp14> be employed to provide fault tolerance in an enterprise server hosting environment.</t>
</section>
<section title="Connection Transfer and Delegation" anchor="n-connection-transfer-and-delegation"><t>It is frequently desirable for a device to negotiate delivery of a service with one host that will ultimately be delivered by another. RDP supports the issue of a 'ticket' credential by a host providing a discovery service that <bcp14>MAY</bcp14> be used to establish a connection with the host that will deliver the requested service:</t>
<figure>
<name>
Connection establishment by means of a discovery service.</name>
<!-- Include SVG File ../Images/PresentationServiceAdvertisement.svg --><artwork type="svg">
<svg width="552" height="185" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 128,0" fill="none" stroke="black" />
  <path d="M 208,0 L 336,0" fill="none" stroke="black" />
  <path d="M 400,0 L 528,0" fill="none" stroke="black" />
  <path d="M 0,48 L 64,48" fill="none" stroke="black" />
  <path d="M 64,48 L 128,48" fill="none" stroke="black" />
  <path d="M 208,48 L 272,48" fill="none" stroke="black" />
  <path d="M 272,48 L 336,48" fill="none" stroke="black" />
  <path d="M 400,48 L 464,48" fill="none" stroke="black" />
  <path d="M 464,48 L 528,48" fill="none" stroke="black" />
  <path d="M 64,80 L 72,80" fill="none" stroke="black" />
  <path d="M 256,80 L 264,80" fill="none" stroke="black" />
  <path d="M 72,96 L 104,96" fill="none" stroke="black" />
  <path d="M 224,96 L 272,96" fill="none" stroke="black" />
  <path d="M 64,128 L 168,128" fill="none" stroke="black" />
  <path d="M 368,128 L 472,128" fill="none" stroke="black" />
  <path d="M 72,144 L 184,144" fill="none" stroke="black" />
  <path d="M 360,144 L 480,144" fill="none" stroke="black" />
  <path d="M 0,0 L 0,48" fill="none" stroke="black" />
  <path d="M 64,48 L 64,80" fill="none" stroke="black" />
  <path d="M 64,80 L 64,128" fill="none" stroke="black" />
  <path d="M 64,128 L 64,160" fill="none" stroke="black" />
  <path d="M 128,0 L 128,48" fill="none" stroke="black" />
  <path d="M 208,0 L 208,48" fill="none" stroke="black" />
  <path d="M 272,48 L 272,96" fill="none" stroke="black" />
  <path d="M 272,96 L 272,112" fill="none" stroke="black" />
  <path d="M 272,152 L 272,168" fill="none" stroke="black" />
  <path d="M 336,0 L 336,48" fill="none" stroke="black" />
  <path d="M 400,0 L 400,48" fill="none" stroke="black" />
  <path d="M 480,64 L 480,144" fill="none" stroke="black" />
  <path d="M 480,144 L 480,160" fill="none" stroke="black" />
  <path d="M 528,0 L 528,48" fill="none" stroke="black" />
  <path d="M 480,56 L 480,64" fill="none" stroke="black" />
  <polygon points="80.000000,96.000000 68.000000,90.400002 68.000000,101.599998" fill="black" transform="rotate(180.000000, 72.000000, 96.000000)" />
  <polygon points="80.000000,144.000000 68.000000,138.399994 68.000000,149.600006" fill="black" transform="rotate(180.000000, 72.000000, 144.000000)" />
  <polygon points="272.000000,80.000000 260.000000,74.400002 260.000000,85.599998" fill="black" transform="rotate(0.000000, 264.000000, 80.000000)" />
  <polygon points="480.000000,128.000000 468.000000,122.400002 468.000000,133.600006" fill="black" transform="rotate(0.000000, 472.000000, 128.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="224" y="84">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="100">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="148">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="84">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="84">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="132">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="20">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="84">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="148">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="132">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="84">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="132">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="132">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="36">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="148">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="20">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="84">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="100">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="20">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="100">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="100">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="148">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="100">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="132">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="132">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="148">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="84">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="84">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="132">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="496" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="84">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="100">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="148">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="148">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="148">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="148">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="100">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="132">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="84">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="132">K</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="148">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="84">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="100">,</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="84">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="100">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="132">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="148">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="84">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="100">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="36">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="148">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="132">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="84">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="504" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="148">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="148">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="148">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="20">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="20">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="132">,</text>
</g></svg>
</artwork>
</figure>
<t>The same capability <bcp14>MAY</bcp14> be applied to enable hosts to direct connected devices to seek service from a different host, either immediately or in case of service interruption. This allows for greater flexibility in configuring systems to provide fault tolerance and to effect load balancing strategies.</t>
</section>
<section title="Presence" anchor="n-presence"><t>Presence is a particular form of connection transfer. A presence service facilitates creation of a voice or video connection between the device used by the initiator to make the request to one of the multiple receiver devices on which it might be accepted.</t>
<t>Each receiver device maintains a connection to the presence service that is active whenever the receiver device is available to accept calls. To request a connection, the initiator device contacts the presence service which determines if the request is authorized and if so, returns the ticket and network endpoint information required to  establish a connection.</t>
<t>For example, Bob's phone connects to the presence service and provides a ticket and network endpoint information to enable calls to be placed. When Alice attempts to place a call, her device contacts the presence service, which checks that Bob has authorized Alice to interrupt her work. Alice's device uses the information from the presence service to perform a forward secrecy operation against Bob's phone and thus achieve full end-to-end secure communication. </t>
<figure>
<name>
Alice contacts Bob through a presence service.</name>
<!-- Include SVG File ../Images/PresentationAlicePresenceBob.svg --><artwork type="svg">
<svg width="536" height="281" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 128,0" fill="none" stroke="black" />
  <path d="M 192,0 L 320,0" fill="none" stroke="black" />
  <path d="M 384,0 L 512,0" fill="none" stroke="black" />
  <path d="M 0,48 L 64,48" fill="none" stroke="black" />
  <path d="M 64,48 L 128,48" fill="none" stroke="black" />
  <path d="M 192,48 L 256,48" fill="none" stroke="black" />
  <path d="M 256,48 L 320,48" fill="none" stroke="black" />
  <path d="M 384,48 L 448,48" fill="none" stroke="black" />
  <path d="M 448,48 L 512,48" fill="none" stroke="black" />
  <path d="M 264,80 L 288,80" fill="none" stroke="black" />
  <path d="M 64,96 L 88,96" fill="none" stroke="black" />
  <path d="M 192,128 L 256,128" fill="none" stroke="black" />
  <path d="M 256,128 L 320,128" fill="none" stroke="black" />
  <path d="M 192,160 L 256,160" fill="none" stroke="black" />
  <path d="M 256,160 L 320,160" fill="none" stroke="black" />
  <path d="M 72,192 L 96,192" fill="none" stroke="black" />
  <path d="M 64,224 L 160,224" fill="none" stroke="black" />
  <path d="M 72,240 L 176,240" fill="none" stroke="black" />
  <path d="M 0,0 L 0,48" fill="none" stroke="black" />
  <path d="M 64,48 L 64,96" fill="none" stroke="black" />
  <path d="M 64,96 L 64,224" fill="none" stroke="black" />
  <path d="M 64,224 L 64,256" fill="none" stroke="black" />
  <path d="M 128,0 L 128,48" fill="none" stroke="black" />
  <path d="M 192,0 L 192,48" fill="none" stroke="black" />
  <path d="M 192,128 L 192,160" fill="none" stroke="black" />
  <path d="M 256,48 L 256,128" fill="none" stroke="black" />
  <path d="M 256,160 L 256,192" fill="none" stroke="black" />
  <path d="M 256,192 L 256,208" fill="none" stroke="black" />
  <path d="M 256,248 L 256,264" fill="none" stroke="black" />
  <path d="M 320,0 L 320,48" fill="none" stroke="black" />
  <path d="M 320,128 L 320,160" fill="none" stroke="black" />
  <path d="M 384,0 L 384,48" fill="none" stroke="black" />
  <path d="M 448,48 L 448,80" fill="none" stroke="black" />
  <path d="M 448,80 L 448,240" fill="none" stroke="black" />
  <path d="M 448,240 L 448,256" fill="none" stroke="black" />
  <path d="M 512,0 L 512,48" fill="none" stroke="black" />
  <polygon points="80.000000,192.000000 68.000000,186.399994 68.000000,197.600006" fill="black" transform="rotate(180.000000, 72.000000, 192.000000)" />
  <polygon points="80.000000,240.000000 68.000000,234.399994 68.000000,245.600006" fill="black" transform="rotate(180.000000, 72.000000, 240.000000)" />
  <polygon points="272.000000,80.000000 260.000000,74.400002 260.000000,85.599998" fill="black" transform="rotate(180.000000, 264.000000, 80.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="192" y="244">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="244">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="100">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="148">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="196">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="228">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="100">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="100">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="100">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="196">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="100">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="228">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="228">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="196">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="228">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="228">&gt;</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="244">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="36">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="100">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="196">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="228">,</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="100">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="148">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="148">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="196">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="148">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="148">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="196">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="84">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="228">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="244">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="244">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="196">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="228">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="244">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="244">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="100">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="244">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="84">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="100">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="148">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="196">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="228">K</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="228">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="84">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="100">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="100">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="196">,</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="228">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="228">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="228">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="84">,</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="228">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="84">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="100">&gt;</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="228">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="84">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="84">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="148">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="148">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="196">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="244">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="20">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="84">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="148">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="228">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="196">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="196">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="20">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="84">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="84">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="84">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="196">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="84">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="244">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="244">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="196">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="100">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="100">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="148">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="228">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="20">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="196">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="228">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="20">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="196">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="196">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="100">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="148">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="228">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="244">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="100">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="196">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="228">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="244">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="244">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="148">n</text>
</g></svg>
</artwork>
</figure>
<t>Contrawise, when Suzy spammer attempts to contact Bob to tell him the warranty on his rocket ship is about to expire, the presence service notes that Suzy spammer is not in Bob's contact list and refuses to allow the interruption. Bob's access control policy may allow Suzy spammer to make a contact exchange request, but it is rather likely that her reputation for wasting people's time will result in that request being rejected.</t>
</section>
<section title="NAT Transit" anchor="n-nat-transit"><t>The deployment of Network Address Translation (NAT) devices in the network represents a real world constraint that every modern network application has to work around if it is to be successful. NAT devices may be broadly regarded as belonging to two distinct categories.</t>
<dl>
<dt>Wide Cone NAT</dt>
<dd>
<t>When a device inside the network attempts to establish a UDP connection to a remote device, the NAT selects an outbound UDP source port for forwarding. All inbound UDP packets specifying that port are forwarded to that device regardless of the source address.</t>
</dd>
<dt>Narrow Cone NAT + Firewall NAT</dt>
<dd>
<t>All NAT devices that present a more restrictive policy. These include enterprise firewalls that require devices inside the network to explicitly request forwarding from external UDP ports (pinhole routing). </t>
</dd>
</dl>
<t>Since the protocols used to support NAT devices other than Wide Cone are typically proprietary, these are outside the scope of this specification.</t>
<t>One of the many inconveniences of being required to support NAT is that the external port binding may change without notice. In some cases, an external port is only kept open for as long as it is in use with timeouts of a second or less being common. </t>
<t>Enabling NAT transit during reconfiguration represents a special case of network agility. The network endpoint can change but the stream identifiers remain constant. A change to the NAT configuration causes inbound packets to be dropped temporarily but the stream is quickly re-established when an outbound packet is sent.</t>
<figure>
<name>
Wide cone NAT configuration.</name>
<!-- Include SVG File ../Images/PresentationNatChange.svg --><artwork type="svg">
<svg width="528" height="281" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 128,0" fill="none" stroke="black" />
  <path d="M 152,0 L 216,0" fill="none" stroke="black" />
  <path d="M 384,0 L 512,0" fill="none" stroke="black" />
  <path d="M 0,32 L 64,32" fill="none" stroke="black" />
  <path d="M 64,32 L 128,32" fill="none" stroke="black" />
  <path d="M 152,32 L 184,32" fill="none" stroke="black" />
  <path d="M 184,32 L 216,32" fill="none" stroke="black" />
  <path d="M 384,32 L 448,32" fill="none" stroke="black" />
  <path d="M 448,32 L 512,32" fill="none" stroke="black" />
  <path d="M 64,64 L 136,64" fill="none" stroke="black" />
  <path d="M 168,64 L 176,64" fill="none" stroke="black" />
  <path d="M 192,64 L 400,64" fill="none" stroke="black" />
  <path d="M 432,64 L 440,64" fill="none" stroke="black" />
  <path d="M 72,80 L 80,80" fill="none" stroke="black" />
  <path d="M 112,80 L 176,80" fill="none" stroke="black" />
  <path d="M 192,80 L 200,80" fill="none" stroke="black" />
  <path d="M 232,80 L 448,80" fill="none" stroke="black" />
  <path d="M 64,96 L 136,96" fill="none" stroke="black" />
  <path d="M 168,96 L 176,96" fill="none" stroke="black" />
  <path d="M 192,96 L 400,96" fill="none" stroke="black" />
  <path d="M 432,96 L 440,96" fill="none" stroke="black" />
  <path d="M 72,112 L 80,112" fill="none" stroke="black" />
  <path d="M 112,112 L 176,112" fill="none" stroke="black" />
  <path d="M 192,112 L 200,112" fill="none" stroke="black" />
  <path d="M 232,112 L 448,112" fill="none" stroke="black" />
  <path d="M 72,128 L 80,128" fill="none" stroke="black" />
  <path d="M 112,128 L 176,128" fill="none" stroke="black" />
  <path d="M 192,128 L 200,128" fill="none" stroke="black" />
  <path d="M 232,128 L 448,128" fill="none" stroke="black" />
  <path d="M 192,192 L 200,192" fill="none" stroke="black" />
  <path d="M 232,192 L 448,192" fill="none" stroke="black" />
  <path d="M 192,208 L 200,208" fill="none" stroke="black" />
  <path d="M 232,208 L 448,208" fill="none" stroke="black" />
  <path d="M 64,224 L 136,224" fill="none" stroke="black" />
  <path d="M 168,224 L 176,224" fill="none" stroke="black" />
  <path d="M 192,224 L 400,224" fill="none" stroke="black" />
  <path d="M 432,224 L 440,224" fill="none" stroke="black" />
  <path d="M 72,240 L 80,240" fill="none" stroke="black" />
  <path d="M 112,240 L 176,240" fill="none" stroke="black" />
  <path d="M 192,240 L 200,240" fill="none" stroke="black" />
  <path d="M 232,240 L 448,240" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 64,32 L 64,64" fill="none" stroke="black" />
  <path d="M 64,64 L 64,96" fill="none" stroke="black" />
  <path d="M 64,96 L 64,224" fill="none" stroke="black" />
  <path d="M 64,224 L 64,256" fill="none" stroke="black" />
  <path d="M 128,0 L 128,32" fill="none" stroke="black" />
  <path d="M 152,0 L 152,32" fill="none" stroke="black" />
  <path d="M 184,32 L 184,144" fill="none" stroke="black" />
  <path d="M 184,176 L 184,256" fill="none" stroke="black" />
  <path d="M 216,0 L 216,32" fill="none" stroke="black" />
  <path d="M 384,0 L 384,32" fill="none" stroke="black" />
  <path d="M 448,32 L 448,80" fill="none" stroke="black" />
  <path d="M 448,80 L 448,112" fill="none" stroke="black" />
  <path d="M 448,112 L 448,128" fill="none" stroke="black" />
  <path d="M 448,128 L 448,192" fill="none" stroke="black" />
  <path d="M 448,192 L 448,208" fill="none" stroke="black" />
  <path d="M 448,208 L 448,240" fill="none" stroke="black" />
  <path d="M 448,240 L 448,256" fill="none" stroke="black" />
  <path d="M 512,0 L 512,32" fill="none" stroke="black" />
  <polygon points="80.000000,80.000000 68.000000,74.400002 68.000000,85.599998" fill="black" transform="rotate(180.000000, 72.000000, 80.000000)" />
  <polygon points="80.000000,112.000000 68.000000,106.400002 68.000000,117.599998" fill="black" transform="rotate(180.000000, 72.000000, 112.000000)" />
  <polygon points="80.000000,128.000000 68.000000,122.400002 68.000000,133.600006" fill="black" transform="rotate(180.000000, 72.000000, 128.000000)" />
  <polygon points="80.000000,240.000000 68.000000,234.399994 68.000000,245.600006" fill="black" transform="rotate(180.000000, 72.000000, 240.000000)" />
  <polygon points="184.000000,64.000000 172.000000,58.400002 172.000000,69.599998" fill="black" transform="rotate(0.000000, 176.000000, 64.000000)" />
  <polygon points="184.000000,96.000000 172.000000,90.400002 172.000000,101.599998" fill="black" transform="rotate(0.000000, 176.000000, 96.000000)" />
  <polygon points="184.000000,224.000000 172.000000,218.399994 172.000000,229.600006" fill="black" transform="rotate(0.000000, 176.000000, 224.000000)" />
  <polygon points="200.000000,80.000000 188.000000,74.400002 188.000000,85.599998" fill="black" transform="rotate(180.000000, 192.000000, 80.000000)" />
  <polygon points="200.000000,112.000000 188.000000,106.400002 188.000000,117.599998" fill="black" transform="rotate(180.000000, 192.000000, 112.000000)" />
  <polygon points="200.000000,128.000000 188.000000,122.400002 188.000000,133.600006" fill="black" transform="rotate(180.000000, 192.000000, 128.000000)" />
  <polygon points="200.000000,192.000000 188.000000,186.399994 188.000000,197.600006" fill="black" transform="rotate(180.000000, 192.000000, 192.000000)" />
  <polygon points="200.000000,208.000000 188.000000,202.399994 188.000000,213.600006" fill="black" transform="rotate(180.000000, 192.000000, 208.000000)" />
  <polygon points="200.000000,240.000000 188.000000,234.399994 188.000000,245.600006" fill="black" transform="rotate(180.000000, 192.000000, 240.000000)" />
  <polygon points="448.000000,64.000000 436.000000,58.400002 436.000000,69.599998" fill="black" transform="rotate(0.000000, 440.000000, 64.000000)" />
  <polygon points="448.000000,96.000000 436.000000,90.400002 436.000000,101.599998" fill="black" transform="rotate(0.000000, 440.000000, 96.000000)" />
  <polygon points="448.000000,224.000000 436.000000,218.399994 436.000000,229.600006" fill="black" transform="rotate(0.000000, 440.000000, 224.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="152" y="100">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="228">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="68">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="68">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="20">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="132">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="164">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="84">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="116">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="116">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="164">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="164">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="196">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="20">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="164">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="164">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="164">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="84">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="164">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="228">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="244">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="100">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="164">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="212">9</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="164">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="244">9</text>
</g></svg>
</artwork>
</figure>
<t>The interaction of NAT transit with presence service presents a particular concern when interactions between the parties are infrequent. </t>
<t>For example, consider the case in which a digital camera is connected to a photo archive on a remote host that is behind a NAT device. This would commonly occur in situations in which Alice wants photographs to be automatically uploaded to the file storage in her house as soon as they are captured.</t>
<t>Rather than requiring the Archive device to maintain a constant RDP stream to every device that might possibly require access, the Archive device maintains a constant stream to the presence service which can then provide devices it has helped establish a connection with the necessary information to resume the stream:</t>
<figure>
<name>
Brokered NAT transit.</name>
<!-- Include SVG File ../Images/PresentationBrokeredNat.svg --><artwork type="svg">
<svg width="536" height="265" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 128,0" fill="none" stroke="black" />
  <path d="M 192,0 L 320,0" fill="none" stroke="black" />
  <path d="M 384,0 L 512,0" fill="none" stroke="black" />
  <path d="M 0,48 L 64,48" fill="none" stroke="black" />
  <path d="M 64,48 L 128,48" fill="none" stroke="black" />
  <path d="M 192,48 L 256,48" fill="none" stroke="black" />
  <path d="M 256,48 L 320,48" fill="none" stroke="black" />
  <path d="M 384,48 L 448,48" fill="none" stroke="black" />
  <path d="M 448,48 L 512,48" fill="none" stroke="black" />
  <path d="M 264,80 L 320,80" fill="none" stroke="black" />
  <path d="M 376,80 L 448,80" fill="none" stroke="black" />
  <path d="M 72,112 L 88,112" fill="none" stroke="black" />
  <path d="M 240,112 L 248,112" fill="none" stroke="black" />
  <path d="M 72,128 L 168,128" fill="none" stroke="black" />
  <path d="M 328,128 L 440,128" fill="none" stroke="black" />
  <path d="M 264,192 L 320,192" fill="none" stroke="black" />
  <path d="M 376,192 L 448,192" fill="none" stroke="black" />
  <path d="M 72,208 L 128,208" fill="none" stroke="black" />
  <path d="M 184,208 L 256,208" fill="none" stroke="black" />
  <path d="M 72,224 L 168,224" fill="none" stroke="black" />
  <path d="M 328,224 L 440,224" fill="none" stroke="black" />
  <path d="M 0,0 L 0,48" fill="none" stroke="black" />
  <path d="M 64,48 L 64,240" fill="none" stroke="black" />
  <path d="M 128,0 L 128,48" fill="none" stroke="black" />
  <path d="M 192,0 L 192,48" fill="none" stroke="black" />
  <path d="M 256,48 L 256,112" fill="none" stroke="black" />
  <path d="M 256,144 L 256,208" fill="none" stroke="black" />
  <path d="M 256,232 L 256,248" fill="none" stroke="black" />
  <path d="M 320,0 L 320,48" fill="none" stroke="black" />
  <path d="M 384,0 L 384,48" fill="none" stroke="black" />
  <path d="M 448,48 L 448,80" fill="none" stroke="black" />
  <path d="M 448,80 L 448,144" fill="none" stroke="black" />
  <path d="M 448,176 L 448,192" fill="none" stroke="black" />
  <path d="M 448,192 L 448,240" fill="none" stroke="black" />
  <path d="M 512,0 L 512,48" fill="none" stroke="black" />
  <polygon points="80.000000,112.000000 68.000000,106.400002 68.000000,117.599998" fill="black" transform="rotate(180.000000, 72.000000, 112.000000)" />
  <polygon points="80.000000,128.000000 68.000000,122.400002 68.000000,133.600006" fill="black" transform="rotate(180.000000, 72.000000, 128.000000)" />
  <polygon points="80.000000,208.000000 68.000000,202.399994 68.000000,213.600006" fill="black" transform="rotate(180.000000, 72.000000, 208.000000)" />
  <polygon points="80.000000,224.000000 68.000000,218.399994 68.000000,229.600006" fill="black" transform="rotate(180.000000, 72.000000, 224.000000)" />
  <polygon points="256.000000,112.000000 244.000000,106.400002 244.000000,117.599998" fill="black" transform="rotate(0.000000, 248.000000, 112.000000)" />
  <polygon points="272.000000,80.000000 260.000000,74.400002 260.000000,85.599998" fill="black" transform="rotate(180.000000, 264.000000, 80.000000)" />
  <polygon points="272.000000,192.000000 260.000000,186.399994 260.000000,197.600006" fill="black" transform="rotate(180.000000, 264.000000, 192.000000)" />
  <polygon points="448.000000,128.000000 436.000000,122.400002 436.000000,133.600006" fill="black" transform="rotate(0.000000, 440.000000, 128.000000)" />
  <polygon points="448.000000,224.000000 436.000000,218.399994 436.000000,229.600006" fill="black" transform="rotate(0.000000, 440.000000, 224.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="280" y="132">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="132">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="228">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="84">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="116">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="212">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="228">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="164">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="164">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="228">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="228">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="116">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="196">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="132">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="164">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="116">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="20">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="20">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="84">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="132">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="132">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="164">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="212">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="164">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="196">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="116">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="212">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="228">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="196">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="228">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="164">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="116">q</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="132">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="212">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="228">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="20">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="20">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="228">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="228">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="228">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="228">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="228">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="196">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="164">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="228">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="164">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="116">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="116">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="116">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="132">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="164">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="116">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="228">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="228">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="228">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="116">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="132">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="36">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="116">e</text>
</g></svg>
</artwork>
</figure>
<t>Another important concern is the interaction between network agility and NAT transit. Mobile devices frequently operate inside and outside a NAT gated network. Care is required to ensure that a device that establishes a direct connection to another device within the same NAT gated local area network can maintain that connection when it moves to a different network.</t>
</section>
<section title="IPv6 Agility" anchor="n-ipv6-agility"><t>RDP makes no distinction between IPv4 and IPv6 transport. In normal circumstances, an application program does not need to be aware of either the initiator or receiver's address(es).</t>
<t>RDP connections <bcp14>MAY</bcp14> be established against either or both simultaneously. RDP is equally tolerant of 4-to-6 and 6-to-4 transmission gateways. </t>
<t>In the interest of reducing the impact of IPv4 address exhaustion, public facing RDP services <bcp14>SHOULD</bcp14> provide discovery and service to initiators that only have connection to an IPv6 network.</t>
</section>
<section title="Tunneling" anchor="n-tunneling"><t>Establishment of an IP tunnel connecting one device to another is required for applications such as onion routing and VPN access.</t>
<t>While the broader requirements of these applications is outside the scope of RDP, consideration has been given for allowing this use case to be supported without causing 'packet inflation' in which every packet submitted as an input results in multiple packets being sent over the network.</t>
<t>Provision for onion routing is likely to be of particular interest. The RDP packet format allows for every bit of the UDP payload to be either encrypted data or an opaque authentication tag.</t>
<t>For example, an observer tapping the network at point A, point B or point C gains no information that allows them to determine that Alice is communicating with Bob. Even correlation of data from all three locations provides limited information through the timing of arrival and almost none that is likely to be of any benefit to the observer.</t>
<figure>
<name>
RDP Tunnelling.</name>
<!-- Include SVG File ../Images/PresentationOnion.svg --><artwork type="svg">
<svg width="544" height="185" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 96,0" fill="none" stroke="black" />
  <path d="M 144,0 L 240,0" fill="none" stroke="black" />
  <path d="M 288,0 L 384,0" fill="none" stroke="black" />
  <path d="M 432,0 L 528,0" fill="none" stroke="black" />
  <path d="M 0,32 L 48,32" fill="none" stroke="black" />
  <path d="M 48,32 L 96,32" fill="none" stroke="black" />
  <path d="M 144,32 L 192,32" fill="none" stroke="black" />
  <path d="M 192,32 L 240,32" fill="none" stroke="black" />
  <path d="M 288,32 L 336,32" fill="none" stroke="black" />
  <path d="M 336,32 L 384,32" fill="none" stroke="black" />
  <path d="M 432,32 L 480,32" fill="none" stroke="black" />
  <path d="M 480,32 L 528,32" fill="none" stroke="black" />
  <path d="M 56,96 L 184,96" fill="none" stroke="black" />
  <path d="M 344,144 L 472,144" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 48,32 L 48,160" fill="none" stroke="black" />
  <path d="M 96,0 L 96,32" fill="none" stroke="black" />
  <path d="M 144,0 L 144,32" fill="none" stroke="black" />
  <path d="M 192,32 L 192,160" fill="none" stroke="black" />
  <path d="M 240,0 L 240,32" fill="none" stroke="black" />
  <path d="M 288,0 L 288,32" fill="none" stroke="black" />
  <path d="M 336,32 L 336,160" fill="none" stroke="black" />
  <path d="M 384,0 L 384,32" fill="none" stroke="black" />
  <path d="M 432,0 L 432,32" fill="none" stroke="black" />
  <path d="M 480,32 L 480,160" fill="none" stroke="black" />
  <path d="M 528,0 L 528,32" fill="none" stroke="black" />
  <polygon points="192.000000,96.000000 180.000000,90.400002 180.000000,101.599998" fill="black" transform="rotate(0.000000, 184.000000, 96.000000)" />
  <polygon points="480.000000,144.000000 468.000000,138.399994 468.000000,149.600006" fill="black" transform="rotate(0.000000, 472.000000, 144.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="408" y="132">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="20">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="100">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="20">O</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="84">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="20">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="68">&gt;</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="116">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="68">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="164">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="164">&gt;</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="20">O</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="116">&gt;</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="132">=</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="132">&gt;</text>
</g></svg>
</artwork>
</figure>
</section>
</section>
</section>
<section title="Definitions" anchor="n-definitions"><t>This section presents the related specifications and standard, the terms that are used as terms of art within the documents and the terms used as requirements language.</t>
<section title="Requirements Language" anchor="n-requirements-language"><t>The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as described in <xref target="RFC2119"></xref>.</t>
</section>
<section title="Defined Terms" anchor="n-defined-terms"></section>
<section title="Related Specifications" anchor="n-related-specifications"></section>
<section title="Implementation Status" anchor="n-implementation-status"><t>The implementation status of the reference code base is described in the companion document <xref target="draft-hallambaker-mesh-developer"></xref>.</t>
</section>
</section>
<section title="Architecture" anchor="n-architecture"><t>Data Encoding</t>
<t>[This part of the specification describes the encodings to be used in the next release. The data encodings in the current reference code used to generate the examples do not match. These should be aligned with QUIC where appropriate.  ]</t>
<t>Encoding at the packet level presents different requirements to those at higher levels. These needs are better met by the compactness afforded by a place-value approach than the JSON/JSON-B Tag-Value encoding used in the upper layers of the Mesh specifications.</t>
<t>As at the application layer, the use of nested length encodings is avoided on account of the risk that bounds overflow vulnerabilities are introduced into applications.</t>
<t>Integer</t>
<t>Integer values are presented using the same variable length encoding described in section 16 <xref target="draft-ietf-quic-transport"> </xref></t>
<t>The first two most significant bits of the first byte are reserved to encode the base 2 logarithm of the integer encoding length in bytes. The integer value is encoded on the remaining bits, in network byte order.</t>
<table><thead>
<tr>
<th>
2 Bit</th>
<th>
Length</th>
<th>
Usable Bits</th>
<th>
Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>
00</td>
<td>
1</td>
<td>
6</td>
<td>
0-63</td>
</tr>
<tr>
<td>
01</td>
<td>
2</td>
<td>
14</td>
<td>
0-16383</td>
</tr>
<tr>
<td>
10</td>
<td>
4</td>
<td>
30</td>
<td>
0-1073741823</td>
</tr>
<tr>
<td>
11</td>
<td>
8</td>
<td>
62</td>
<td>
0-4611686018427387903</td>
</tr>
</tbody>
</table><t>Values do not need to be encoded on the minimum number of bytes necessary.</t>
<t>String</t>
<t>String values are Unicode strings encoded as a sequence of UTF-8 bytes preceded by an integer length specifier. </t>
<t>Binary data</t>
<t>Binary data consists of a sequence of opaque bytes encoded as the sequence of byte values preceded by  an integer length specifier.</t>
<t>Packet Extension List</t>
<t>Packet extensions <bcp14>MAY</bcp14> be specified in any data section of a datagram.</t>
<t>Each extension is a tag-length-value sequence:</t>
<dl>
<dt>Tag</dt>
<dd>
<t>A sequence of 1 to 16 octets, the leading octets of which are in the range 0-127 and the final octet of which is in the range 128-255.</t>
</dd>
<dt>Length </dt>
<dd>
<t>The number of octets in the Value encoded as an Integer.</t>
</dd>
<dt>Value</dt>
<dd>
<t>An opaque sequence of the specified number of octets.</t>
</dd>
</dl>
<t>The tag 255 is reserved to signal the end of the packet extension list.</t>
<t>Stream Identifier</t>
<t>Every RDP packet begins with a <strong>stream identifier</strong>. Stream identifiers consist of an opaque sequence of zero to 16 bytes.</t>
<t>Stream identifiers are used to allow their issuer to distinguish packets arriving from different streams in circumstances where the stream cannot be inferred from the port. Initiators and responders both issue stream identifiers for their own use during Connection Establishment. Additional stream identifiers <bcp14>MAY</bcp14> be issued as a means of defeating some forms of traffic analysis attack. </t>
<t>The semantics and encoding of stream identifiers including determining the length of the stream identifier is sole concern of the issuer which <bcp14>MUST</bcp14> ensure that it can correctly interpret the stream identifiers they issue for streams received on a specified port without ambiguity.</t>
<t>Stream identifiers are issued as binary data sequences specified in Connection Establishment packets and as Packet Extensions in Data Packets.</t>
<t>Issuers <bcp14>MUST</bcp14> accept every stream identifier issued as a valid identifier for that stream for the lifetime of the connection in which the stream was created.</t>
<section title="Connections" anchor="n-connections"><t>An RDP connection is a bidirectional relationship between two devices secured by a <em>Connection Shared Secret</em> established through a key agreement between the devices. Once established a connection <bcp14>MAY</bcp14> be persisted for as long as the devices are willing to assign memory resources at each end. Unlike TCP connections, maintaining an RDP connection does not require communication overhead (but maintaining a NAT transit capability might).</t>
</section>
<section title="Ports" anchor="n-ports"><t>An RDP port is a synonym for network endpoint. Only ports at which traffic is received are of concern.</t>
<t>Currently two port types are defined:</t>
<dl>
<dt>HTTP Web Service Endpoint</dt>
<dd>
<t>A port type that is limited to supporting transactional streams</t>
</dd>
<dt>UDP Network Endpoint</dt>
<dd>
<t>A network endpoint that receives Internet communications directed at a particular IP Address and Port.</t>
</dd>
</dl>
<t>The collection of ports associated with a connection <bcp14>MAY</bcp14> change over time. Connections <bcp14>MAY</bcp14> make use of multiple ports simultaneously. </t>
<t>For example, a virtual reality streaming game might establish a single connection to a game coordination host and make use of separate ports to achieve the desired latency and bandwidth characteristics.</t>
</section>
<section title="Stream" anchor="n-stream"><t>An RDP stream is an asymmetric bidirectional channel that transmits a sequence of datagrams according to a defined characteristic. Two characteristics are currently defined:</t>
<dl>
<dt>Transactional Stream</dt>
<dd>
</dd>
<dt>Asynchronous Stream</dt>
<dd>
</dd>
</dl>
<t>The stream characteristic and cryptographic parameters of a stream are immutable for the lifetime of a stream. To effect a forward secrecy exchange, a new stream is created and the existing stream closed.</t>
<t>Each stream is separately identified by one or more Stream Identifiers at each end specified by the party that receives data at that end.</t>
<t>Stream identifiers <bcp14>MUST</bcp14> be unique for the lifetime of a stream. Stream identifiers <bcp14>MAY</bcp14> be reused after the stream has been closed.</t>
<section title="Transactional stream" anchor="n-transactional-stream"><t>Streams with a transactional characteristic are used to engage in a request/response communication pattern with a service specified during stream negotiation:</t>
<figure>
<name>
Transactional stream characteristic.</name>
<!-- Include SVG File ../Images/PresentationStreamTransactional.svg --><artwork type="svg">
<svg width="464" height="233" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 160,0" fill="none" stroke="black" />
  <path d="M 288,0 L 448,0" fill="none" stroke="black" />
  <path d="M 0,32 L 80,32" fill="none" stroke="black" />
  <path d="M 80,32 L 160,32" fill="none" stroke="black" />
  <path d="M 288,32 L 376,32" fill="none" stroke="black" />
  <path d="M 376,32 L 448,32" fill="none" stroke="black" />
  <path d="M 80,64 L 184,64" fill="none" stroke="black" />
  <path d="M 264,64 L 368,64" fill="none" stroke="black" />
  <path d="M 88,80 L 184,80" fill="none" stroke="black" />
  <path d="M 272,80 L 376,80" fill="none" stroke="black" />
  <path d="M 80,112 L 184,112" fill="none" stroke="black" />
  <path d="M 264,112 L 368,112" fill="none" stroke="black" />
  <path d="M 88,128 L 184,128" fill="none" stroke="black" />
  <path d="M 272,128 L 376,128" fill="none" stroke="black" />
  <path d="M 80,176 L 184,176" fill="none" stroke="black" />
  <path d="M 264,176 L 368,176" fill="none" stroke="black" />
  <path d="M 88,192 L 184,192" fill="none" stroke="black" />
  <path d="M 272,192 L 376,192" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 80,32 L 80,64" fill="none" stroke="black" />
  <path d="M 80,64 L 80,112" fill="none" stroke="black" />
  <path d="M 80,112 L 80,176" fill="none" stroke="black" />
  <path d="M 80,176 L 80,208" fill="none" stroke="black" />
  <path d="M 160,0 L 160,32" fill="none" stroke="black" />
  <path d="M 288,0 L 288,32" fill="none" stroke="black" />
  <path d="M 376,32 L 376,80" fill="none" stroke="black" />
  <path d="M 376,80 L 376,128" fill="none" stroke="black" />
  <path d="M 376,128 L 376,192" fill="none" stroke="black" />
  <path d="M 376,192 L 376,208" fill="none" stroke="black" />
  <path d="M 448,0 L 448,32" fill="none" stroke="black" />
  <polygon points="96.000000,80.000000 84.000000,74.400002 84.000000,85.599998" fill="black" transform="rotate(180.000000, 88.000000, 80.000000)" />
  <polygon points="96.000000,128.000000 84.000000,122.400002 84.000000,133.600006" fill="black" transform="rotate(180.000000, 88.000000, 128.000000)" />
  <polygon points="96.000000,192.000000 84.000000,186.399994 84.000000,197.600006" fill="black" transform="rotate(180.000000, 88.000000, 192.000000)" />
  <polygon points="376.000000,64.000000 364.000000,58.400002 364.000000,69.599998" fill="black" transform="rotate(0.000000, 368.000000, 64.000000)" />
  <polygon points="376.000000,112.000000 364.000000,106.400002 364.000000,117.599998" fill="black" transform="rotate(0.000000, 368.000000, 112.000000)" />
  <polygon points="376.000000,176.000000 364.000000,170.399994 364.000000,181.600006" fill="black" transform="rotate(0.000000, 368.000000, 176.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="84">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="116">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="116">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="196">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="68">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="180">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="196">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="84">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="196">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="132">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="180">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="180">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="68">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="116">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="180">q</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="180">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="196">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="196">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="196">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="68">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="116">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="68">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="68">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="84">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="84">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="68">q</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="116">q</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="68">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="132">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="196">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="84">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="196">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="84">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="180">e</text>
</g></svg>
</artwork>
</figure>
<t>Each transactional stream is asymmetric, but a connection <bcp14>MAY</bcp14> contain separate transactional streams going in each direction.</t>
<t>For example, in a notary application, two hosts might offer notary service to the other through the same connection but through separate streams.</t>
</section>
<section title="Asynchronous stream" anchor="n-asynchronous-stream"><t>Streams with an asynchronous characteristic deliver a stream of datagrams created by the stream originator to the stream receiver. Datagrams carrying control information sent in the reverse direction <bcp14>MAY</bcp14> be used to control the flow.</t>
<figure>
<name>
Asynchronous stream characteristic.</name>
<!-- Include SVG File ../Images/PresentationStreamAsynchronous.svg --><artwork type="svg">
<svg width="464" height="281" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 160,0" fill="none" stroke="black" />
  <path d="M 288,0 L 448,0" fill="none" stroke="black" />
  <path d="M 0,48 L 80,48" fill="none" stroke="black" />
  <path d="M 80,48 L 160,48" fill="none" stroke="black" />
  <path d="M 288,48 L 376,48" fill="none" stroke="black" />
  <path d="M 376,48 L 448,48" fill="none" stroke="black" />
  <path d="M 80,80 L 176,80" fill="none" stroke="black" />
  <path d="M 272,80 L 368,80" fill="none" stroke="black" />
  <path d="M 88,96 L 168,96" fill="none" stroke="black" />
  <path d="M 280,96 L 376,96" fill="none" stroke="black" />
  <path d="M 88,128 L 184,128" fill="none" stroke="black" />
  <path d="M 264,128 L 376,128" fill="none" stroke="black" />
  <path d="M 88,144 L 184,144" fill="none" stroke="black" />
  <path d="M 264,144 L 376,144" fill="none" stroke="black" />
  <path d="M 88,160 L 184,160" fill="none" stroke="black" />
  <path d="M 264,160 L 376,160" fill="none" stroke="black" />
  <path d="M 88,176 L 184,176" fill="none" stroke="black" />
  <path d="M 264,176 L 376,176" fill="none" stroke="black" />
  <path d="M 80,208 L 176,208" fill="none" stroke="black" />
  <path d="M 272,208 L 368,208" fill="none" stroke="black" />
  <path d="M 88,240 L 184,240" fill="none" stroke="black" />
  <path d="M 264,240 L 376,240" fill="none" stroke="black" />
  <path d="M 88,256 L 184,256" fill="none" stroke="black" />
  <path d="M 264,256 L 376,256" fill="none" stroke="black" />
  <path d="M 0,0 L 0,48" fill="none" stroke="black" />
  <path d="M 80,48 L 80,80" fill="none" stroke="black" />
  <path d="M 80,80 L 80,208" fill="none" stroke="black" />
  <path d="M 80,208 L 80,256" fill="none" stroke="black" />
  <path d="M 160,0 L 160,48" fill="none" stroke="black" />
  <path d="M 288,0 L 288,48" fill="none" stroke="black" />
  <path d="M 376,48 L 376,96" fill="none" stroke="black" />
  <path d="M 376,96 L 376,128" fill="none" stroke="black" />
  <path d="M 376,128 L 376,144" fill="none" stroke="black" />
  <path d="M 376,144 L 376,160" fill="none" stroke="black" />
  <path d="M 376,160 L 376,176" fill="none" stroke="black" />
  <path d="M 376,176 L 376,240" fill="none" stroke="black" />
  <path d="M 376,240 L 376,256" fill="none" stroke="black" />
  <path d="M 448,0 L 448,48" fill="none" stroke="black" />
  <polygon points="96.000000,96.000000 84.000000,90.400002 84.000000,101.599998" fill="black" transform="rotate(180.000000, 88.000000, 96.000000)" />
  <polygon points="96.000000,128.000000 84.000000,122.400002 84.000000,133.600006" fill="black" transform="rotate(180.000000, 88.000000, 128.000000)" />
  <polygon points="96.000000,144.000000 84.000000,138.399994 84.000000,149.600006" fill="black" transform="rotate(180.000000, 88.000000, 144.000000)" />
  <polygon points="96.000000,160.000000 84.000000,154.399994 84.000000,165.600006" fill="black" transform="rotate(180.000000, 88.000000, 160.000000)" />
  <polygon points="96.000000,176.000000 84.000000,170.399994 84.000000,181.600006" fill="black" transform="rotate(180.000000, 88.000000, 176.000000)" />
  <polygon points="96.000000,240.000000 84.000000,234.399994 84.000000,245.600006" fill="black" transform="rotate(180.000000, 88.000000, 240.000000)" />
  <polygon points="96.000000,256.000000 84.000000,250.399994 84.000000,261.600006" fill="black" transform="rotate(180.000000, 88.000000, 256.000000)" />
  <polygon points="376.000000,80.000000 364.000000,74.400002 364.000000,85.599998" fill="black" transform="rotate(0.000000, 368.000000, 80.000000)" />
  <polygon points="376.000000,208.000000 364.000000,202.399994 364.000000,213.600006" fill="black" transform="rotate(0.000000, 368.000000, 208.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="376" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="260">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="260">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="100">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="180">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="180">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="212">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="84">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="100">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="260">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="36">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="148">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="180">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="100">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="244">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="148">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="244">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="260">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="260">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="84">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="84">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="36">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="100">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="180">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="180">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="212">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="244">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="212">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="212">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="100">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="164">3</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="164">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="164">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="212">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="100">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="100">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="84">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="148">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="164">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="212">f</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="244">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="36">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="84">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="100">w</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="132">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="148">2</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="148">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="212">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="212">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="36">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="100">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="260">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="84">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="36">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="244">5</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="164">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="212">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="84">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="164">F</text>
</g></svg>
</artwork>
</figure>
<t>Asynchronous streams <bcp14>MAY</bcp14> be used for intermittent communications as well as real time streaming media. For example, a network server might use an asynchronous stream to log transaction data to another machine.</t>
</section>
</section>
<section title="Credentials" anchor="n-credentials"><t>RDP follows the Mesh approach of using separate credentials for devices and principals. </t>
<t>For example, the service offered by provider (@provider) is delivered by a fault tolerant collection of three separate hosts. Alice (@alice) can access those services through any one of her four personal devices.</t>
<figure>
<name>
Mesh Layered Credential Model.</name>
<!-- Include SVG File ../Images/PresentationLayeredCredential.svg --><artwork type="svg">
<svg width="520" height="185" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 160,0" fill="none" stroke="black" />
  <path d="M 296,0 L 456,0" fill="none" stroke="black" />
  <path d="M 168,16 L 288,16" fill="none" stroke="black" />
  <path d="M 0,32 L 80,32" fill="none" stroke="black" />
  <path d="M 80,32 L 160,32" fill="none" stroke="black" />
  <path d="M 296,32 L 384,32" fill="none" stroke="black" />
  <path d="M 384,32 L 456,32" fill="none" stroke="black" />
  <path d="M 0,80 L 496,80" fill="none" stroke="black" />
  <path d="M 0,128 L 80,128" fill="none" stroke="black" />
  <path d="M 80,128 L 160,128" fill="none" stroke="black" />
  <path d="M 296,128 L 384,128" fill="none" stroke="black" />
  <path d="M 384,128 L 456,128" fill="none" stroke="black" />
  <path d="M 168,144 L 288,144" fill="none" stroke="black" />
  <path d="M 0,160 L 160,160" fill="none" stroke="black" />
  <path d="M 296,160 L 456,160" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 0,128 L 0,160" fill="none" stroke="black" />
  <path d="M 160,0 L 160,32" fill="none" stroke="black" />
  <path d="M 160,128 L 160,160" fill="none" stroke="black" />
  <path d="M 296,0 L 296,32" fill="none" stroke="black" />
  <path d="M 296,128 L 296,160" fill="none" stroke="black" />
  <path d="M 456,0 L 456,32" fill="none" stroke="black" />
  <path d="M 456,128 L 456,160" fill="none" stroke="black" />
  <polygon points="176.000000,16.000000 164.000000,10.400000 164.000000,21.600000" fill="black" transform="rotate(180.000000, 168.000000, 16.000000)" />
  <polygon points="176.000000,144.000000 164.000000,138.399994 164.000000,149.600006" fill="black" transform="rotate(180.000000, 168.000000, 144.000000)" />
  <polygon points="296.000000,16.000000 284.000000,10.400000 284.000000,21.600000" fill="black" transform="rotate(0.000000, 288.000000, 16.000000)" />
  <polygon points="296.000000,144.000000 284.000000,138.399994 284.000000,149.600006" fill="black" transform="rotate(0.000000, 288.000000, 144.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="68">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="132">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="116">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="100">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="68">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="52">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="68">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="68">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="100">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="4">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="148">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="148">H</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="68">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="116">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="148">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="52">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="132">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="148">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="504" y="100">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="68">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="68">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="100">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="148">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="4">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="4">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="68">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="68">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="496" y="68">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="148">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="4">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="68">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="100">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="100">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="148">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="4">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="4">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="4">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="68">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="100">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="100">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="4">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="100">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="68">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="132">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="132">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="148">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="4">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="100">:</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="100">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="496" y="100">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="132">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="4">C</text>
</g></svg>
</artwork>
</figure>
<t>RDP makes use of the keys specified in device credentials to perform key agreement and enables user and service credential(s) to be presented for authentication and authorization of the principals.</t>
<section title="Device" anchor="n-device"><t>An RDP device credential is a credential that specifies a public key of one of the supported key agreement algorithms. Two forms of device credential are currently defined:</t>
<ul>
<li>Raw Key (e.g. X.448 key)</li>
<li>Mesh Device Connection Assertion.</li>
</ul>
<t>It might well be the case that it is more appropriate to pass the Device Connection Assertion as part of the Principal Credential.</t>
</section>
<section title="Principal" anchor="n-principal"><t>Principal credentials are used to authenticate and authorize a device to act on behalf of the specified principal. </t>
<t>Presentation of Principal Credentials <bcp14>MAY</bcp14> be performed at the application layer (i.e. by means of credentials carried in an RDP payload) or as an RDP Packet Extension when a <strong>stream service binding</strong> is requested.</t>
<t>In either case, validation of Principal Credentials is an application concern and thus outside the scope of RDP.</t>
<t>Different streams <bcp14>MAY</bcp14> involve the use of different principal credentials. Alice might be authenticated through her Mesh profile in one stream, a PKIX client cert bound to a smartcard in another and a SAML authorization token in a third.</t>
</section>
</section>
<section title="Datagram Format" anchor="n-datagram-format"><t>An RDP Datagram is by definition the smallest unit of payload data passed from the application layer to the presentation layer or vice versa. A Datagram <bcp14>MAY</bcp14> be as large as a complete frame of 4K or 8K video or as small as a single key press or movement of a game controller.</t>
<t>Use of HTTP ports places no upper limit on the size of an RDP Datagram but UDP Datagrams are limited to a maximum number of packets. </t>
<figure>
<name>
Datagram format.</name>
<!-- Include SVG File ../Images/PresentationDatagram.svg --><artwork type="svg">
<svg width="536" height="169" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 120,0" fill="none" stroke="black" />
  <path d="M 120,0 L 240,0" fill="none" stroke="black" />
  <path d="M 240,0 L 416,0" fill="none" stroke="black" />
  <path d="M 416,0 L 520,0" fill="none" stroke="black" />
  <path d="M 248,32 L 280,32" fill="none" stroke="black" />
  <path d="M 376,32 L 408,32" fill="none" stroke="black" />
  <path d="M 0,48 L 120,48" fill="none" stroke="black" />
  <path d="M 120,48 L 240,48" fill="none" stroke="black" />
  <path d="M 240,48 L 416,48" fill="none" stroke="black" />
  <path d="M 416,48 L 520,48" fill="none" stroke="black" />
  <path d="M 136,80 L 224,80" fill="none" stroke="black" />
  <path d="M 416,80 L 520,80" fill="none" stroke="black" />
  <path d="M 120,112 L 224,112" fill="none" stroke="black" />
  <path d="M 224,112 L 344,112" fill="none" stroke="black" />
  <path d="M 344,112 L 520,112" fill="none" stroke="black" />
  <path d="M 120,144 L 224,144" fill="none" stroke="black" />
  <path d="M 224,144 L 344,144" fill="none" stroke="black" />
  <path d="M 344,144 L 520,144" fill="none" stroke="black" />
  <path d="M 0,0 L 0,48" fill="none" stroke="black" />
  <path d="M 120,0 L 120,48" fill="none" stroke="black" />
  <path d="M 120,96 L 120,112" fill="none" stroke="black" />
  <path d="M 120,112 L 120,144" fill="none" stroke="black" />
  <path d="M 224,112 L 224,144" fill="none" stroke="black" />
  <path d="M 240,0 L 240,48" fill="none" stroke="black" />
  <path d="M 240,48 L 240,64" fill="none" stroke="black" />
  <path d="M 344,112 L 344,144" fill="none" stroke="black" />
  <path d="M 416,0 L 416,48" fill="none" stroke="black" />
  <path d="M 416,48 L 416,80" fill="none" stroke="black" />
  <path d="M 520,0 L 520,48" fill="none" stroke="black" />
  <path d="M 520,80 L 520,112" fill="none" stroke="black" />
  <path d="M 520,112 L 520,144" fill="none" stroke="black" />
  <polygon points="256.000000,32.000000 244.000000,26.400000 244.000000,37.599998" fill="black" transform="rotate(180.000000, 248.000000, 32.000000)" />
  <path d="M 320,56 L 320,64" fill="none" stroke="black" />
  <polygon points="336.000000,64.000000 324.000000,58.400002 324.000000,69.599998" fill="black" transform="rotate(270.000000, 320.000000, 64.000000)" />
  <path d="M 320,96 L 320,104" fill="none" stroke="black" />
  <polygon points="336.000000,96.000000 324.000000,90.400002 324.000000,101.599998" fill="black" transform="rotate(90.000000, 320.000000, 96.000000)" />
  <polygon points="416.000000,32.000000 404.000000,26.400000 404.000000,37.599998" fill="black" transform="rotate(0.000000, 408.000000, 32.000000)" />
  <path d="M 136,80 A 16,16 0 0,0 120,96" fill="none" stroke="black" />
  <path d="M 240,64 A 16,16 0 0,1 224,80" fill="none" stroke="black" />
  <text text-anchor="middle" font-family="sans-serif" x="496" y="36">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="132">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="132">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="20">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="36">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="36">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="36">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="20">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="132">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="132">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="20">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="132">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="36">0</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="132">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="132">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="36">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="132">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="132">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="36">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="36">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="36">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="36">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="36">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="132">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="36">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="36">R</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="36">8</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="36">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="496" y="20">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="36">-</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="36">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="84">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="20">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="36">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="132">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="36">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="84">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="132">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="132">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="20">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="84">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="132">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="20">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="36">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="132">Z</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="132">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="132">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="132">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="20">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="132">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="20">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="36">-</text>
</g></svg>
</artwork>
</figure>
<t>Requests and Responses <bcp14>MAY</bcp14> be split into multiple Datagrams. In this case every datagram except the final one is marked with the continuation flag.</t>
<t>APIs <bcp14>MAY</bcp14> choose to present the individual datagrams to applications or reconstruct the complete datagram according to what best fits their circumstances.</t>
<section title="Stream Identifier" anchor="n-stream-identifier"><t>A sequence of bytes as specified by the recipient during establishment of the connection or stream.</t>
</section>
<section title="Nonce" anchor="n-nonce"><t>The keys used to encrypt and authenticate each datagram are derived by applying a key derivation function to the Stream Primary Key, the Stream identifier and a nonce value specified in the datagram itself.</t>
<t>The nonce is the value of a monotonically increasing datagram counter.</t>
</section>
<section title="Ciphertext" anchor="n-ciphertext"><t>Ciphertext is the plaintext payload encrypted under a key derived from the active primary key and the initialization vector. Keys are only used to encrypt a single Datagram or continuation Datagram. </t>
<t>Plaintext of a data Datagram consists of a list of packet extension entries followed by a payload followed by zero padding.</t>
</section>
<section title="Authentication Tag" anchor="n-authentication-tag"><t>Associated data is entire Datagram from the first byte to the start of the Initialization vector.</t>
</section>
</section>
<section title="Packet Format and Packetized Datagrams" anchor="n-packet-format-and-packetized-datagrams"><t>UDP provides unreliable transport of datagrams no larger than the maximum IP payload size of 64KB. In practice the largest datagram payload is typically limited to no more than 1260 bytes because the Ethernet specification is stuck in the Middle Ages. It is thus necessary to split large Datagrams into multiple packets and provide sufficient control information that the receiver can reassemble the packets in the right order and request any lost packets be re-sent.</t>
<t>Similar constraints are imposed by a wide range of wireless and wired physical and network transports.</t>
<t>When using Packetized Datagrams, each packet in the Datagram specifies the stream identifier and a packet identifier. Only the last packet in the Datagram presents an authentication tag.</t>
<figure>
<name>
Datagram packetization across multiple packets.</name>
<!-- Include SVG File ../Images/PresentationPacketizedDatagram.svg --><artwork type="svg">
<svg width="504" height="281" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,16 L 104,16" fill="none" stroke="black" />
  <path d="M 104,16 L 208,16" fill="none" stroke="black" />
  <path d="M 208,16 L 336,16" fill="none" stroke="black" />
  <path d="M 352,16 L 360,16" fill="none" stroke="black" />
  <path d="M 376,16 L 384,16" fill="none" stroke="black" />
  <path d="M 384,16 L 488,16" fill="none" stroke="black" />
  <path d="M 0,48 L 104,48" fill="none" stroke="black" />
  <path d="M 104,48 L 208,48" fill="none" stroke="black" />
  <path d="M 208,48 L 336,48" fill="none" stroke="black" />
  <path d="M 352,48 L 360,48" fill="none" stroke="black" />
  <path d="M 376,48 L 384,48" fill="none" stroke="black" />
  <path d="M 384,48 L 488,48" fill="none" stroke="black" />
  <path d="M 0,96 L 104,96" fill="none" stroke="black" />
  <path d="M 104,96 L 208,96" fill="none" stroke="black" />
  <path d="M 208,96 L 448,96" fill="none" stroke="black" />
  <path d="M 0,128 L 104,128" fill="none" stroke="black" />
  <path d="M 104,128 L 208,128" fill="none" stroke="black" />
  <path d="M 208,128 L 448,128" fill="none" stroke="black" />
  <path d="M 0,160 L 104,160" fill="none" stroke="black" />
  <path d="M 104,160 L 208,160" fill="none" stroke="black" />
  <path d="M 208,160 L 448,160" fill="none" stroke="black" />
  <path d="M 0,192 L 104,192" fill="none" stroke="black" />
  <path d="M 104,192 L 208,192" fill="none" stroke="black" />
  <path d="M 208,192 L 448,192" fill="none" stroke="black" />
  <path d="M 0,224 L 104,224" fill="none" stroke="black" />
  <path d="M 104,224 L 208,224" fill="none" stroke="black" />
  <path d="M 208,224 L 344,224" fill="none" stroke="black" />
  <path d="M 344,224 L 448,224" fill="none" stroke="black" />
  <path d="M 0,256 L 104,256" fill="none" stroke="black" />
  <path d="M 104,256 L 208,256" fill="none" stroke="black" />
  <path d="M 208,256 L 344,256" fill="none" stroke="black" />
  <path d="M 344,256 L 448,256" fill="none" stroke="black" />
  <path d="M 0,16 L 0,48" fill="none" stroke="black" />
  <path d="M 0,96 L 0,128" fill="none" stroke="black" />
  <path d="M 0,160 L 0,192" fill="none" stroke="black" />
  <path d="M 0,224 L 0,256" fill="none" stroke="black" />
  <path d="M 104,16 L 104,48" fill="none" stroke="black" />
  <path d="M 104,96 L 104,128" fill="none" stroke="black" />
  <path d="M 104,160 L 104,192" fill="none" stroke="black" />
  <path d="M 104,224 L 104,256" fill="none" stroke="black" />
  <path d="M 208,16 L 208,48" fill="none" stroke="black" />
  <path d="M 208,96 L 208,128" fill="none" stroke="black" />
  <path d="M 208,160 L 208,192" fill="none" stroke="black" />
  <path d="M 208,224 L 208,256" fill="none" stroke="black" />
  <path d="M 344,224 L 344,256" fill="none" stroke="black" />
  <path d="M 384,16 L 384,48" fill="none" stroke="black" />
  <path d="M 448,96 L 448,128" fill="none" stroke="black" />
  <path d="M 448,160 L 448,192" fill="none" stroke="black" />
  <path d="M 448,224 L 448,256" fill="none" stroke="black" />
  <path d="M 488,16 L 488,48" fill="none" stroke="black" />
  <text text-anchor="middle" font-family="sans-serif" x="48" y="244">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="244">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="116">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="180">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="244">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="4">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="180">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="244">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="244">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="244">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="84">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="116">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="116">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="116">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="180">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="8" y="4">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="244">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="244">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="116">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="116">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="116">H</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="244">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="36">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="180">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="180">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="180">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="180">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="36">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="180">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="116">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="180">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="116">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="180">2</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="36">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="8" y="84">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="116">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="84">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="116">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="244">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="244">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="244">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="4">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="36">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="36">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="180">H</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="244">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="244">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="84">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="180">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="244">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="244">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="36">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="244">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="180">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="116">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="36">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="244">3</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="36">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="116">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="180">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="84">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="116">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="180">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="0" y="4">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="244">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="244">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="244">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="36">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="116">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="116">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="116">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="4">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="36">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="116">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="244">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="244">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="36">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="36">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="116">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="180">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="244">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="36">N</text>
  <text text-anchor="middle" font-family="sans-serif" x="0" y="84">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="180">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="244">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="244">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="36">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="116">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="180">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="180">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="244">H</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="244">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="116">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="180">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="116">e</text>
</g></svg>
</artwork>
</figure>
<t>RDP Datagram packetization is analogous to IP packet fragmentation except that it actually works.</t>
<section title="Packet Header" anchor="n-packet-header"><t>The packet header block appears immediately after the Stream identifier. It specifies the information used to reassemble packets in order to form a complete datagram, to acknowledge packet receipt, and other control information.</t>
<dl>
<dt>Datagram index</dt>
<dd>
<t>Integer counter beginning at 0 and incremented by 1 for each partial or final datagram sent in the stream.</t>
</dd>
<dt>Packet count</dt>
<dd>
<t>Integer specifying the number of packets in the datagram</t>
</dd>
<dt>Packet sent index</dt>
<dd>
<t>Integer counter beginning at 0 and incremented by 1 for each packet sent wrapping at 15 bits.</t>
</dd>
<dt>Retransmit index</dt>
<dd>
<t>Integer incremented each time a packet is resent. Since the resent data is identical, it is only necessary to acknowledge data once even if multiple copies are received.</t>
</dd>
<dt>Continuation Datagram flag.</dt>
<dd>
<t>Integer containing flags information. The low order bit (0) is 0 for a partial datagram and 1 for a final datagram.</t>
</dd>
<dt>Received index</dt>
<dd>
<t>Integer index of the first packet being acknowledged.</t>
</dd>
<dt>Acknowledgements</dt>
<dd>
<t>Bitfield containing the value 1 for packets that have been received and 0 otherwise. </t>
</dd>
</dl>
<figure>
<name>
Flow control packet header</name>
<!-- Include SVG File ../Images/PresentationFlowControl.svg --><artwork type="svg">
<svg width="536" height="217" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 80,0" fill="none" stroke="black" />
  <path d="M 80,0 L 160,0" fill="none" stroke="black" />
  <path d="M 160,0 L 240,0" fill="none" stroke="black" />
  <path d="M 240,0 L 320,0" fill="none" stroke="black" />
  <path d="M 320,0 L 400,0" fill="none" stroke="black" />
  <path d="M 400,0 L 520,0" fill="none" stroke="black" />
  <path d="M 0,64 L 80,64" fill="none" stroke="black" />
  <path d="M 80,64 L 160,64" fill="none" stroke="black" />
  <path d="M 160,64 L 240,64" fill="none" stroke="black" />
  <path d="M 240,64 L 264,64" fill="none" stroke="black" />
  <path d="M 264,64 L 320,64" fill="none" stroke="black" />
  <path d="M 320,64 L 400,64" fill="none" stroke="black" />
  <path d="M 400,64 L 520,64" fill="none" stroke="black" />
  <path d="M 0,128 L 520,128" fill="none" stroke="black" />
  <path d="M 0,192 L 520,192" fill="none" stroke="black" />
  <path d="M 0,0 L 0,64" fill="none" stroke="black" />
  <path d="M 0,128 L 0,192" fill="none" stroke="black" />
  <path d="M 80,0 L 80,64" fill="none" stroke="black" />
  <path d="M 160,0 L 160,64" fill="none" stroke="black" />
  <path d="M 240,0 L 240,64" fill="none" stroke="black" />
  <path d="M 264,64 L 264,112" fill="none" stroke="black" />
  <path d="M 320,0 L 320,64" fill="none" stroke="black" />
  <path d="M 400,0 L 400,64" fill="none" stroke="black" />
  <path d="M 520,0 L 520,64" fill="none" stroke="black" />
  <path d="M 520,128 L 520,192" fill="none" stroke="black" />
  <path d="M 264,112 L 264,120" fill="none" stroke="black" />
  <polygon points="280.000000,112.000000 268.000000,106.400002 268.000000,117.599998" fill="black" transform="rotate(90.000000, 264.000000, 112.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="192" y="52">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="20">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="148">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="180">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="36">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="100">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="148">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="180">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="148">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="148">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="20">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="36">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="100">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="20">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="52">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="52">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="180">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="504" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="36">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="52">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="20">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="148">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="180">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="180">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="20">w</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="148">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="20">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="20">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="36">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="52">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="36">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="36">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="52">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="20">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="52">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="148">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="180">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="496" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="36">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="148">H</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="52">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="52">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="20">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="20">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="424" y="36">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="36">L</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="100">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="148">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="20">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="52">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="148">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="320" y="100">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="20">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="52">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="20">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="36">f</text>
  <text text-anchor="middle" font-family="sans-serif" x="480" y="52">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="36">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="52">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="100">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="148">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="36">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="52">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="148">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="512" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="36">q</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="148">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="36">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="328" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="148">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="148">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="148">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="52">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="180">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="52">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="52">y</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="52">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="472" y="20">g</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="36">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="52">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="148">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="464" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="52">b</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="148">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="20">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="36">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="100">S</text>
</g></svg>
</artwork>
</figure>
</section>
<section title="Flow Control" anchor="n-flow-control"><t>TCP flow control is designed to meet the needs of the day. Modern networks have very different needs.</t>
<t>Congestion avoidance is still important and implementations <bcp14>MUST</bcp14> take steps to avoid overburdening network resources.</t>
<t>May require additional packets that only contain flow control info. This <bcp14>MAY</bcp14> be used to communicate One time Stream IDs.</t>
<t>Congestion control limits <bcp14>MAY</bcp14> be specified for the connection as a whole and for individual ports. In situations where multiple Internet connections are available, applications <bcp14>MUST</bcp14> enforce flow control limits on each port.</t>
<t>[Here describe the feedback characteristics determined through experimentation.]</t>
</section>
</section>
<section title="Connection Datagrams" anchor="n-connection-datagrams"><t>Connection Datagrams are used during the key exchange used to establish a connection. Unlike data Datagrams in which have a single data section, all of which is encrypted, connection Datagrams may contain three separate types of data section:</t>
<dl>
<dt>Plaintext data</dt>
<dd>
<t>Unencrypted data section. This is used to pass the information needed to perform the 'mezzanine' key exchange to the responder's credential and to present and respond to challenges.</t>
</dd>
<dt>Mezzanine data</dt>
<dd>
<t>Data encrypted under 'mezzanine' key exchange authenticated by the responder's credential alone. This is used to pass information related to the initiator credential.</t>
</dd>
<dt>Ciphertext data</dt>
<dd>
<t>Data encrypted under the mutual key exchange authenticated to the credentials of the initiator and the responder.</t>
</dd>
</dl>
<t>The <tt>ClientCompleteDeferred</tt> Datagram contains all three data sections. The ciphertext data section is encapsulated inside the Mezzanine data section and is thus encrypted twice. Only the Mezzanine section is padded.</t>
<figure>
<name>
Connection Datagram Format.</name>
<!-- Include SVG File ../Images/PresentationConnectionDatagram.svg --><artwork type="svg">
<svg width="536" height="89" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 96,0" fill="none" stroke="black" />
  <path d="M 96,0 L 192,0" fill="none" stroke="black" />
  <path d="M 192,0 L 520,0" fill="none" stroke="black" />
  <path d="M 192,32 L 328,32" fill="none" stroke="black" />
  <path d="M 328,32 L 416,32" fill="none" stroke="black" />
  <path d="M 416,32 L 472,32" fill="none" stroke="black" />
  <path d="M 472,32 L 520,32" fill="none" stroke="black" />
  <path d="M 0,64 L 96,64" fill="none" stroke="black" />
  <path d="M 96,64 L 192,64" fill="none" stroke="black" />
  <path d="M 192,64 L 328,64" fill="none" stroke="black" />
  <path d="M 328,64 L 416,64" fill="none" stroke="black" />
  <path d="M 416,64 L 472,64" fill="none" stroke="black" />
  <path d="M 472,64 L 520,64" fill="none" stroke="black" />
  <path d="M 0,0 L 0,64" fill="none" stroke="black" />
  <path d="M 96,0 L 96,64" fill="none" stroke="black" />
  <path d="M 192,0 L 192,32" fill="none" stroke="black" />
  <path d="M 192,32 L 192,64" fill="none" stroke="black" />
  <path d="M 328,32 L 328,64" fill="none" stroke="black" />
  <path d="M 472,32 L 472,64" fill="none" stroke="black" />
  <path d="M 520,0 L 520,32" fill="none" stroke="black" />
  <path d="M 520,32 L 520,64" fill="none" stroke="black" />
  <text text-anchor="middle" font-family="sans-serif" x="376" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="52">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="36">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="288" y="52">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="52">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="52">h</text>
  <text text-anchor="middle" font-family="sans-serif" x="448" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="296" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="52">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="456" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="36">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="52">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="408" y="52">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="440" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="36">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="36">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="52">z</text>
  <text text-anchor="middle" font-family="sans-serif" x="304" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="52">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="432" y="52">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="20">z</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="36">l</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="36">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="52">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="52">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="496" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="36">x</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="36">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="52">M</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="52">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="504" y="52">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="36">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="36">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="36">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="52">p</text>
  <text text-anchor="middle" font-family="sans-serif" x="344" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="336" y="20">M</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="52">z</text>
  <text text-anchor="middle" font-family="sans-serif" x="312" y="52">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="488" y="52">P</text>
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">z</text>
  <text text-anchor="middle" font-family="sans-serif" x="416" y="52">t</text>
</g></svg>
</artwork>
</figure>
<t>A connection Datagram <bcp14>MAY</bcp14> contain a payload. This is always carried in the last data section.</t>
<t>Connection Datagrams that only contain plaintext data <bcp14>MUST NOT</bcp14> contain confidential data. This requirement may be enforced in a future revision of the specification by limiting use to a 'service discovery' protocol.</t>
</section>
</section>
<section title="Connection Establishment and Maintenance" anchor="n-connection-establishment-and-maintenance"><section title="Key Exchange modes" anchor="n-key-exchange-modes"><t>Three key exchange mechanisms are supported. The choice of mechanism depending on whether the initiator knows the credentials of the host and on whether the host is willing to perform a key exchange operation without challenge:</t>
<dl>
<dt>First Contact</dt>
<dd>
<t>The only key exchange mode supported when the client does not know the responder credential. This is a two-round exchange in which the payload of the first round is limited to plaintext data. </t>
</dd>
<dt>Immediate</dt>
<dd>
<t>A key exchange in which the initiator knows the responder and offers a complete mutual key exchange in the first message. If accepted by the responder, this exchange requires only a single round which <bcp14>MAY</bcp14> carry ciphertext payload.</t>
</dd>
<dt>Deferred</dt>
<dd>
<t>A variation of the zero round trip exchange in which the responder returns a plaintext challenge to the initiator instead of immediately accepting the key exchange. This permits mitigation of denial-of-service attacks.</t>
</dd>
</dl>
<t>Unlike other RDP interactions, the response to a connection establishment request <bcp14>MUST</bcp14> be returned to the network endpoint from which it was received.</t>
<t>The <tt>InitiatorHello</tt> datagram and <tt>InitiatorExchange</tt> datagram are special in that they <bcp14>MUST</bcp14> be presented in a single packet and <bcp14>MUST</bcp14> use the Stream Identifier consisting of sixteen zero bytes.</t>
<section title="First Contact" anchor="n-first-contact"><t>The first contact exchange comprises two round trips:</t>
<dl>
<dt><tt>InitiatorHello</tt></dt>
<dd>
<t>[Plaintext] Stream ID, Payload</t>
</dd>
<dt><tt>ResponderChallenge</tt></dt>
<dd>
<t>[Plaintext] Responder credential, </t>
<t>[Plaintext] Set of responder ephemeral keys</t>
<t>[Plaintext] Challenge</t>
<t>[Plaintext] Stream ID, Payload</t>
</dd>
<dt><tt>InitiatorComplete</tt></dt>
<dd>
<t>[Plaintext] Responder key identifier</t>
<t>[Plaintext] Initiator Ephemeral</t>
<t>[Plaintext] Response to Challenge</t>
<t>[Mezzanine] Initiator Credential + Initiator key identifier</t>
<t>[Encrypted] Stream ID, Payload</t>
</dd>
<dt><tt>Data</tt></dt>
<dd>
<t>[Encrypted] Stream ID, Payload</t>
</dd>
</dl>
<t>For example...</t>
<t>Key exchange example TBS </t>
<t>Since the InitiatorHello and InitiatorComplete payloads are always sent <em>en clair</em>, these are only available for use in querying the public capabilities exposed by the responder. For example, the set of services offered.</t>
</section>
<section title="Immediate" anchor="n-immediate"><t>The immediate exchange comprises a single round trip:</t>
<dl>
<dt><tt>InitiatorExchange</tt></dt>
<dd>
<t>[Plaintext] Responder key identifier</t>
<t>[Plaintext] Initiator Ephemeral</t>
<t>[Mezzanine] Initiator Credential + Initiator key identifier</t>
<t>[Mezzanine] Stream ID, Payload</t>
</dd>
<dt><tt>ResponderComplete</tt></dt>
<dd>
<t>[Mezzanine] Initiator key identifier</t>
<t>[Mezzanine] Responder Ephemeral</t>
<t>[Encrypted] Stream ID, Payload</t>
</dd>
</dl>
<t>Note that in this case the initial initiator payload is only encrypted, it is only authenticated to the responder since the responder has not contributed any form of challenge data to the initiator. </t>
<t>For example...</t>
<t>Key exchange example TBS </t>
<t></t>
</section>
<section title="Deferred Trip" anchor="n-deferred-trip"><t>The deferred exchange is an alternative to the immediate exchange that is performed at the option of the responder. Instead of accepting the connection request immediately, the initiator defers acceptance of the request until the initiator has given a correct response to a challenge:</t>
<dl>
<dt><tt>InitiatorExchange</tt></dt>
<dd>
<t>(As for the Immediate case)</t>
</dd>
<dt><tt>ResponderDefer</tt></dt>
<dd>
<t>[Plaintext] Responder credential, </t>
<t>[Plaintext] Set of responder ephemeral keys</t>
<t>[Plaintext] Challenge</t>
<t>[Plaintext] Stream ID, Payload</t>
</dd>
<dt><tt>InitiatorComplete</tt></dt>
<dd>
<t>(As for the First Contact case)</t>
</dd>
</dl>
<t>Key exchange example TBS </t>
</section>
</section>
<section title="Ticketed Connection" anchor="n-ticketed-connection"><t>For supporting presence and discovery services.</t>
<t>Ticket specifies a shared secret, session ID, network end point.</t>
<t>Example discovery, Alice's device connects to the provider's discovery service, is authenticated and receives a ticket to connect to a specific host. This allows a connection to be established to that host without the need to perform a connection key exchange.</t>
<t>Example presence, Alice wants to talk to Bob, contacts his discovery service, gets a ticket back allowing Bob to establish a direct, encrypted connection.</t>
<t>In either case, a client <bcp14>SHOULD</bcp14> perform a rekey operation as indicated by requirements for perfect forward secrecy, security policy, yada yada.</t>
</section>
<section title="Connection Forward Secrecy Rekeying" anchor="n-connection-forward-secrecy-rekeying"><t>Rekeying is only necessary to provide forward secrecy. The data encrypted under a single symmetric key is a small fraction of the maximum. But a connection that persists for several years still represents a liability.</t>
<t>[Should we reintroduce the mezzanine packet so we can use the remainder of a packet without rekeying?]</t>
<t>[Packet extension contains the rekey data]</t>
</section>
</section>
<section title="Stream Establishment and Maintenance" anchor="n-stream-establishment-and-maintenance"><section title="Stream Creation and Binding" anchor="n-stream-creation-and-binding"><t>When a stream is created, it is typically bound to a service.</t>
<t>A host might offer Mesh, Callsign and Discovery services. After connecting to the host, a device requests a stream to each of the services in turn. Each stream <bcp14>MAY</bcp14> be separately authorized. </t>
</section>
<section title="Stream Close" anchor="n-stream-close"><t>Streams <bcp14>MAY</bcp14> be closed when no longer needed. This allows reuse of the stream identifier(s) associated with the stream provided that no ambiguity can arise.</t>
</section>
<section title="One Time Stream Identifier" anchor="n-one-time-stream-identifier"><t>In cases where defeating traffic analysis is of particular importance, a recipient <bcp14>MAY</bcp14> assign multiple identifiers to a single stream.</t>
<t>For example, a device connecting issues a set of three stream identifiers to a service. The device receives two packets which are acknowledged together with a further three one-time use identifiers.</t>
<figure>
<name>
Use of one time Stream identifiers.</name>
<!-- Include SVG File ../Images/PresentationOneTimeStreamIdRecharge.svg --><artwork type="svg">
<svg width="464" height="265" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 160,0" fill="none" stroke="black" />
  <path d="M 288,0 L 448,0" fill="none" stroke="black" />
  <path d="M 0,32 L 80,32" fill="none" stroke="black" />
  <path d="M 80,32 L 160,32" fill="none" stroke="black" />
  <path d="M 288,32 L 376,32" fill="none" stroke="black" />
  <path d="M 376,32 L 448,32" fill="none" stroke="black" />
  <path d="M 80,64 L 152,64" fill="none" stroke="black" />
  <path d="M 288,64 L 368,64" fill="none" stroke="black" />
  <path d="M 88,96 L 160,96" fill="none" stroke="black" />
  <path d="M 296,96 L 376,96" fill="none" stroke="black" />
  <path d="M 88,128 L 160,128" fill="none" stroke="black" />
  <path d="M 296,128 L 376,128" fill="none" stroke="black" />
  <path d="M 80,160 L 160,160" fill="none" stroke="black" />
  <path d="M 296,160 L 368,160" fill="none" stroke="black" />
  <path d="M 88,192 L 160,192" fill="none" stroke="black" />
  <path d="M 296,192 L 376,192" fill="none" stroke="black" />
  <path d="M 88,224 L 160,224" fill="none" stroke="black" />
  <path d="M 296,224 L 376,224" fill="none" stroke="black" />
  <path d="M 0,0 L 0,32" fill="none" stroke="black" />
  <path d="M 80,32 L 80,64" fill="none" stroke="black" />
  <path d="M 80,64 L 80,160" fill="none" stroke="black" />
  <path d="M 80,160 L 80,240" fill="none" stroke="black" />
  <path d="M 160,0 L 160,32" fill="none" stroke="black" />
  <path d="M 288,0 L 288,32" fill="none" stroke="black" />
  <path d="M 376,32 L 376,96" fill="none" stroke="black" />
  <path d="M 376,96 L 376,128" fill="none" stroke="black" />
  <path d="M 376,128 L 376,192" fill="none" stroke="black" />
  <path d="M 376,192 L 376,224" fill="none" stroke="black" />
  <path d="M 376,224 L 376,240" fill="none" stroke="black" />
  <path d="M 448,0 L 448,32" fill="none" stroke="black" />
  <polygon points="96.000000,96.000000 84.000000,90.400002 84.000000,101.599998" fill="black" transform="rotate(180.000000, 88.000000, 96.000000)" />
  <polygon points="96.000000,128.000000 84.000000,122.400002 84.000000,133.600006" fill="black" transform="rotate(180.000000, 88.000000, 128.000000)" />
  <polygon points="96.000000,192.000000 84.000000,186.399994 84.000000,197.600006" fill="black" transform="rotate(180.000000, 88.000000, 192.000000)" />
  <polygon points="96.000000,224.000000 84.000000,218.399994 84.000000,229.600006" fill="black" transform="rotate(180.000000, 88.000000, 224.000000)" />
  <polygon points="376.000000,64.000000 364.000000,58.400002 364.000000,69.599998" fill="black" transform="rotate(0.000000, 368.000000, 64.000000)" />
  <polygon points="376.000000,160.000000 364.000000,154.399994 364.000000,165.600006" fill="black" transform="rotate(0.000000, 368.000000, 160.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="360" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="68">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="132">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="228">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="164">5</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="196">3</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="228">5</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="228">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="228">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="228">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="20">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="400" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="100">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="100">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="164">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="132">2</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="164">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="164">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="228">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="132">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="164">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="196">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="216" y="68">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="100">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="100">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="100">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="100">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="228">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="100">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="100">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="100">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="100">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="164">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="196">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="196">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="228">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="88" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="132">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="164">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="196">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="280" y="196">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="228">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="68">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="68">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="68">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="132">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="228">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="352" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="376" y="20">v</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="164">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="132">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="196">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="164">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="368" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="392" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="68">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="132">F</text>
  <text text-anchor="middle" font-family="sans-serif" x="176" y="164">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="132">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="164">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="192" y="196">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="20">c</text>
  <text text-anchor="middle" font-family="sans-serif" x="384" y="20">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="68">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="184" y="68">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="272" y="68">3</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="196">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="248" y="196">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="196">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="68">#</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="68">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="224" y="132">2</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="164">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="200" y="196">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="256" y="100">D</text>
  <text text-anchor="middle" font-family="sans-serif" x="240" y="132">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="232" y="68">2</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="100">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="208" y="228">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="264" y="228">#</text>
</g></svg>
</artwork>
</figure>
<t>A block cipher <bcp14>MAY</bcp14> be employed to construct one time IDs that require no state to interpret. The issuer generates a fixed symmetric key. To create a new one time StreamID, the issuer encrypts a block containing a salt (e.g. a unique sequence number) and the stream ID to which the encrypted Id is to be mapped.</t>
<t>To interpret a one time ID, the service simply decrypts the encrypted form to recover the original stream ID, the salt is ignored.</t>
<t>Note that when using this approach it is absolutely critical that the cipher used is a block cipher and not a stream cipher or a block cipher used in a streaming mode (e.g. AES-GCM).</t>
<figure>
<name>
Use of a block cipher to create stateless stream identifiers.</name>
<!-- Include SVG File ../Images/PresentationOneTimeStreamId.svg --><artwork type="svg">
<svg width="208" height="185" xmlns="http://www.w3.org/2000/svg" >
<g transform="translate(8,16)">
  <path d="M 0,0 L 96,0" fill="none" stroke="black" />
  <path d="M 96,0 L 192,0" fill="none" stroke="black" />
  <path d="M 0,48 L 96,48" fill="none" stroke="black" />
  <path d="M 96,48 L 192,48" fill="none" stroke="black" />
  <path d="M 0,112 L 192,112" fill="none" stroke="black" />
  <path d="M 0,160 L 192,160" fill="none" stroke="black" />
  <path d="M 0,0 L 0,48" fill="none" stroke="black" />
  <path d="M 0,112 L 0,160" fill="none" stroke="black" />
  <path d="M 96,0 L 96,48" fill="none" stroke="black" />
  <path d="M 96,48 L 96,96" fill="none" stroke="black" />
  <path d="M 192,0 L 192,48" fill="none" stroke="black" />
  <path d="M 192,112 L 192,160" fill="none" stroke="black" />
  <path d="M 96,96 L 96,104" fill="none" stroke="black" />
  <polygon points="112.000000,96.000000 100.000000,90.400002 100.000000,101.599998" fill="black" transform="rotate(90.000000, 96.000000, 96.000000)" />
  <text text-anchor="middle" font-family="sans-serif" x="160" y="84">)</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="132">T</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="148">2</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="148">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="20">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="20">u</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="20">C</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="20">o</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="20">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="148">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="84">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="132">O</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="132">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="148">8</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="132">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="36">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="132">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="148">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="132">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="20">I</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="20">n</text>
  <text text-anchor="middle" font-family="sans-serif" x="152" y="84">k</text>
  <text text-anchor="middle" font-family="sans-serif" x="96" y="132">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="20">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="24" y="36">6</text>
  <text text-anchor="middle" font-family="sans-serif" x="56" y="36">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="132">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="132">a</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="36">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="104" y="148">i</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="20">d</text>
  <text text-anchor="middle" font-family="sans-serif" x="32" y="36">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="128" y="36">4</text>
  <text text-anchor="middle" font-family="sans-serif" x="120" y="84">E</text>
  <text text-anchor="middle" font-family="sans-serif" x="16" y="20">S</text>
  <text text-anchor="middle" font-family="sans-serif" x="40" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="160" y="20">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="168" y="20">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="48" y="36">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="84">A</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="132">m</text>
  <text text-anchor="middle" font-family="sans-serif" x="112" y="132">r</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="148">1</text>
  <text text-anchor="middle" font-family="sans-serif" x="64" y="36">t</text>
  <text text-anchor="middle" font-family="sans-serif" x="72" y="36">s</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="36">B</text>
  <text text-anchor="middle" font-family="sans-serif" x="144" y="84">(</text>
  <text text-anchor="middle" font-family="sans-serif" x="80" y="132">e</text>
  <text text-anchor="middle" font-family="sans-serif" x="136" y="132">m</text>
</g></svg>
</artwork>
</figure>
</section>
<section title="Stream Rekey" anchor="n-stream-rekey"><t>Rekeying the stream requires us to change the stream ID. No other characteristics of the stream are changed.</t>
<t>Stream can rekey by specifying its own rekey data or say 'use the same keydata as this stream Id'.</t>
<t>Thus, a connection with four separate streams only needs to perform one rekey to refresh the crypto for all four.</t>
</section>
</section>
<section title="Schema" anchor="n-schema"><section title="Connection Datagrams" anchor="n-connection-datagrams-0"></section>
<section title="Packet Extensions" anchor="n-packet-extensions"></section>
</section>
<section title="Security Considerations" anchor="n-security-considerations"></section>
<section title="IANA Considerations" anchor="n-iana-considerations"><t>This document requires no IANA actions.</t>
</section>
<section title="Acknowledgements" anchor="n-acknowledgements"><t></t>
</section>
</middle>
<back>
<references title="Normative References"><reference anchor="RFC2119"><front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author fullname="S. Bradner" initials="S." surname="Bradner"><organization/>
<address>
</address>
</author>
<date month="March" year="1997"/>
</front>
<seriesInfo name="BCP" value="14"/>
<seriesInfo name="RFC" value="2119"/>
<seriesInfo name="DOI" value="10.17487/RFC2119"/>
</reference>
<reference anchor="draft-ietf-quic-transport"><front>
<title>QUIC: A UDP-Based Multiplexed and Secure Transport</title>
<author fullname="Jana Iyengar" initials="J" surname="Iyengar"><organization/>
<address>
</address>
</author>
<author fullname="Martin Thomson" initials="M" surname="Thomson"><organization/>
<address>
</address>
</author>
<date day="14" month="January" year="2021"/>
</front>
<seriesInfo name="Internet-Draft" value="draft-ietf-quic-transport-34"/>
<format type="TXT" target="http://www.ietf.org/internet-drafts/draft-ietf-quic-transport-34.txt"/>
</reference>
</references>
<references title="Informative References"><reference anchor="draft-hallambaker-mesh-developer"><front>
<title>Mathematical Mesh: Reference Implementation</title>
<author fullname="Phillip Hallam-Baker" initials="P" surname="Hallam-Baker"><organization/>
<address>
</address>
</author>
<date day="27" month="July" year="2020"/>
</front>
<seriesInfo name="Internet-Draft" value="draft-hallambaker-mesh-developer-10"/>
<format type="TXT" target="http://www.ietf.org/internet-drafts/draft-hallambaker-mesh-developer-10.txt"/>
</reference>
</references>
</back>
</rfc>
