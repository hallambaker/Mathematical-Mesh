#using System.Text
#using Goedel.Mesh
#using Goedel.Mesh.Shell
#using Goedel.Protocol
#xclass ExampleGenerator CreateExamples



#xfile CreateExamples WebMail "Guide/mail.md" CreateExamples Examples

## Using the `mail` Command Set

The `mail` command set contains commands used to manage Internet mail 
application profiles and to create and manage credentials for the 
OpenPGP and S/MIME security enhancements for Internet mail.

Multiple mail profiles may be connected to a single Mesh profile to
allow access to multiple accounts.

#### Creating a mail profile

A mail application profile is added to a Mesh profile using the 
#{ToCommand("mail add")} command:

#%  ConsoleExample (Examples.MailAdd);

The client attempts to obtain the network configuration for the inbound and
outbound mail services using [SRV auto 
configuration](https://tools.ietf.org/html/draft-daboo-srv-email-02).

Alternatively, the configuration may be given explicitly using the form 
\<domain\>:\<port\>:

#%  ConsoleExample (Examples.MailAddExplicit);

The mail profile only contains the network configuration information. Access 
credentials for the inbound and outbound mail services must be configured in the
email application(s) from which they are used or in the Mesh credential manager.

Account profiles may be updated to change the network configuration using the
#{ToCommand("mail add")} command:

#%  ConsoleExample (Examples.MailUpdate);

Specifying no values causes the SRV auto configuration configuration data to be 
used replacing the values previously set.

#### Creating an OpenPGP Key Set

An OpenPGP public key pair for encryption and authentication may be added to the
profile when it is created or as a later update using the `/openpgp` option:

#%  ConsoleExample (Examples.MailUpdateOpenPGP);

The private key may be extracted from the profile in a variety of interchange
formats to allow installation in a key service:

#%  ConsoleExample (Examples.MailOpenPGPPrivate);

The public key may be exported likewise:

#%  ConsoleExample (Examples.MailOpenPGPPublic);

#### Creating an S/MIME Key Set

An S/MIME public key pair for encryption and authentication may be added to the
profile when it is created or as a later update using the `/smime` option:

#%  ConsoleExample (Examples.MailUpdateSMIME);

By default, a self signed certificate is created.

The #{ToCommand("mail smime validate")}  causes a certificate request to be sent to the
specified Certificate Authority service via ACME:

#%  ConsoleExample (Examples.MailSMIMECA);

Responding to the validation challenge requires an access credential for the 
inbound email service to be specified.

The private key may be extracted from the profile in a variety of interchange
formats to allow installation in a key service:

#%  ConsoleExample (Examples.MailSMIMEPrivate);

The public key may be exported likewise:

#%  ConsoleExample (Examples.MailSMIMEPublic);

#end xfile

#xfile CreateExamples MailReference "Reference/mail.md" CreateExamples Examples
#% var CommandSet = CommandLineInterpreter.DescribeCommandSet_Mail;


#% Describe(CommandSet);


#% Describe(CommandSet, _MailAdd._DescribeCommand);
#% Describe(CommandSet, _MailUpdate._DescribeCommand);
#% Describe(CommandSet, _SMIMEPrivate._DescribeCommand);
#% Describe(CommandSet, _SMIMEPublic._DescribeCommand);
#% Describe( CommandSet, _PGPPrivate._DescribeCommand);
#% Describe( CommandSet, _PGPPublic._DescribeCommand);


#end xfile

#end xclass

