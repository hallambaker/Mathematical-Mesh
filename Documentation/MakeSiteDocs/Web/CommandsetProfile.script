#using System.Text
#using Goedel.Mesh
#using Goedel.Mesh.Shell
#using Goedel.Protocol
#xclass ExampleGenerator CreateExamples



#xfile CreateExamples WebProfile "Guide/profile.md" CreateExamples Examples

## Using the `profile` Command Set

The `profile` command set contains commands used to create and manage
Mesh profiles.


#### Contacting a Mesh Service

The #{ToCommand("profile hello")} command contacts a Mesh service and returns
a description of the service parameters.

#%  ConsoleExample (Examples.ProfileHello);

If a Mesh account is specified, the tool attempts to connect to a Mesh service
at the associated domain. It is not necessary for the account to be registered
at the service when the request is made.

#### Creating a profile

To begin using the Mesh, it is necessary for the user to create a Mesh profile.
This includes the steps of:

* Create a Master profile.

* Create a device profile.

* Create a Mesh profile and make the current device an administrator.

* Register the Mesh profile with a Mesh service.

The #{ToCommand("profile create")} command creates a profile:

#%  ConsoleExample (Examples.ProfileAliceCreate);

The #{ToCommand("profile register")} commands registers a profile:

#%  ConsoleExample (Examples.ProfileAliceRegister);

Or we can perform both at once by specifying the service to register the profile when we create the
profile:

#%  ConsoleExample (Examples.ProfileCreateBob);


#### Synchronizing a profile

The #{ToCommand("profile ")} command is used to synchronize the catalogs and 
spools associated with a Mesh profile:

#%  ConsoleExample (Examples.ProfileSync);

Synchronization is also performed automatically before every command requiring 
interaction with the Mesh service.

#### Listing profiles installed on a machine

The #{ToCommand("profile list")} command lists all the profiles available on the 
machine:

#%  ConsoleExample (Examples.ProfileList);

The #{ToCommand("profile dump")} command provides a more detailed description of 
a profile:

#%  ConsoleExample (Examples.ProfileDump);

#### Escrowing Profile Master Keys

The more reliance that a user puts on a cryptographic infrastructure, the more 
serious the consequences of the loss of the encryption and authentication keys.
As the recent episode of 'ransomware' attacks demonstrates, for most users, the
very worst security compromise that could affect them is the loss of the
pictures of their children when they were five years old.

The #{ToCommand("profile ")} command escrows the signature and encryption keys
of the user's master profile and returns a set of recovery shares. 

#%  ConsoleExample (Examples.ProfileEscrow);

By default, three recovery shares are created such that two shares are required to
recover the master keys.

Recovery of the master keys is performed by the #{ToCommand("profile recover")}
command.

#%  ConsoleExample (Examples.ProfileRecover);

The `/verify` flag causes the tool to check that the keys can be correctly recovered
without actually installing on the machine.

#### Changing the Mesh Service

The #{ToCommand("profile ")} command allows a profile to be registered at a different
Mesh Service:

#%  ConsoleExample (Examples.ProfileRegister);

Although the Mesh protocols are designed to allow a Mesh profile to be registered with
multiple services, this use is not currently implemented in the Mesh reference code.

#### Direct profile management

A Mesh profile may be exported as a file using the #{ToCommand("profile ")} command:

#%  ConsoleExample (Examples.ProfileExport);

The #{ToCommand("profile ")} profile can then be used to import the file on another 
machine:

#%  ConsoleExample (Examples.ProfileImport);

#end xfile

#xfile CreateExamples ProfileReference "Reference/profile.md" CreateExamples Examples
#% var CommandSet = CommandLineInterpreter.DescribeCommandSet_Profile;


#% Describe(CommandSet);

#% Describe(CommandSet, _ProfileCreate._DescribeCommand);

The `profile create` command creates a new Mesh master profile and 
(optionally) registers it with a Mesh service.

By default, the default device profile of the current account is registered as an
administrator device of the newly created profile. If no default device exists, a 
new device profile is created. The `/new` option may be used to force a new device
profile to be created.

The `/did` and `/dd` options specify an identifier and description for the device if
a new profile is created. Otherwise, platform defaults are used.

Cryptographic algorithms to be used for the signature and encryption algorithms 
may be specified using the `/alg` option.

#%  ConsoleReference (Examples.ProfileAliceCreate);


#% Describe(CommandSet, _ProfileEscrow._DescribeCommand);

The `profile escrow` command 

#%  ConsoleReference (Examples.ProfileEscrow);

#% Describe(CommandSet, _ProfileExport._DescribeCommand);

The `profile export` command 

#%  ConsoleReference (Examples.ProfileExport);

#% Describe(CommandSet, _ProfileGet._DescribeCommand);

The `profile get` command 

#%  ConsoleReference (Examples.ProfileDump);


#% Describe(CommandSet, _ProfileHello._DescribeCommand);

The `profile hello` command attempts to contact a Mesh service and reports the
service configuration if successful.

#%  ConsoleReference (Examples.ProfileHello);

#% Describe(CommandSet, _ProfileImport._DescribeCommand);

The `profile import` command 

#%  ConsoleReference (Examples.ProfileImport);

#% Describe(CommandSet, _ProfileList._DescribeCommand);

The `profile list` command 

#%  ConsoleReference (Examples.ProfileList);


#% Describe(CommandSet, _ProfileRecover._DescribeCommand);

The `profile recover` command 

#%  ConsoleReference (Examples.ProfileRecover);

#% Describe(CommandSet, _ProfileRegister._DescribeCommand);

The `profile register` command 

#%  ConsoleReference (Examples.ProfileRegister);

#% Describe(CommandSet, _ProfileSync._DescribeCommand);

The `profile sync` command 

#%  ConsoleReference (Examples.ProfileSync);













#end xfile

#end xclass

